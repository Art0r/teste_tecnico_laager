  [1m[35m (1.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, NULL, NULL), (2, 'Theo Becker', 0, NULL, NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:01:25.737982', '2025-10-03 02:01:25.737982'), (2, 'Theo Becker', 0, '2025-10-03 02:01:25.737982', '2025-10-03 02:01:25.737982')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
ParticipantsControllerTest: test_should_get_index
-------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started GET "/participants" for 127.0.0.1 at 2025-10-02 23:01:25 -0300
Processing by ParticipantsController#index as JSON
  Parameters: {"participant"=>{}}
Listando participantes
  [1m[36mParticipant Load (0.8ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC[0m
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.8ms | Allocations: 3426)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:01:35.897765', '2025-10-03 02:01:35.897765'), (2, 'Theo Becker', 0, '2025-10-03 02:01:35.897765', '2025-10-03 02:01:35.897765')[0m
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
ParticipantsControllerTest: test_should_get_index
-------------------------------------------------
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started GET "/participants" for 127.0.0.1 at 2025-10-02 23:01:35 -0300
Processing by ParticipantsController#index as JSON
  Parameters: {"participant"=>{}}
Listando participantes
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC[0m
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.6ms | Allocations: 3427)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (2.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:09:09.433280', '2025-10-03 02:09:09.433280'), (2, 'Theo Becker', 0, '2025-10-03 02:09:09.433280', '2025-10-03 02:09:09.433280')[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/one/upvote" for 127.0.0.1 at 2025-10-02 23:09:09 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"one"}
Id one is not a number
Filter chain halted as :set_participant rendered or redirected
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 283)
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", nil], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:09:56.596313', '2025-10-03 02:09:56.596313'), (2, 'Theo Becker', 0, '2025-10-03 02:09:56.596313', '2025-10-03 02:09:56.596313')[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:09:56 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 7ms (Views: 0.3ms | ActiveRecord: 0.5ms | Allocations: 6747)
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:10:34.294570', '2025-10-03 02:10:34.294570'), (2, 'Theo Becker', 0, '2025-10-03 02:10:34.294570', '2025-10-03 02:10:34.294570')[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:10:34 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 7ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 6747)
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Update (2.8ms)[0m  [1m[33mUPDATE "ar_internal_metadata" SET "value" = 'test', "updated_at" = '2025-10-03 02:11:46.952416' WHERE "ar_internal_metadata"."key" = 'environment'[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (9.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:11:51.368159', '2025-10-03 02:11:51.368159'), (2, 'Theo Becker', 0, '2025-10-03 02:11:51.368159', '2025-10-03 02:11:51.368159')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:11:51 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 17ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 6766)
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (8.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:12:44.650714', '2025-10-03 02:12:44.650714'), (2, 'Theo Becker', 0, '2025-10-03 02:12:44.650714', '2025-10-03 02:12:44.650714')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:12:44 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.3ms | ActiveRecord: 0.6ms | Allocations: 597)
  [1m[36mCACHE Participant Load (0.0ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (7.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:13:36.867285', '2025-10-03 02:13:36.867285'), (2, 'Theo Becker', 0, '2025-10-03 02:13:36.867285', '2025-10-03 02:13:36.867285')[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:13:36 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 597)
  [1m[36mCACHE Participant Load (0.0ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (8.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:14:01.888486', '2025-10-03 02:14:01.888486'), (2, 'Theo Becker', 0, '2025-10-03 02:14:01.888486', '2025-10-03 02:14:01.888486')[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:14:01 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 597)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (8.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:15:23.580650', '2025-10-03 02:15:23.580650'), (2, 'Theo Becker', 0, '2025-10-03 02:15:23.580650', '2025-10-03 02:15:23.580650')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:15:23 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 597)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (8.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:15:26.661496', '2025-10-03 02:15:26.661496'), (2, 'Theo Becker', 0, '2025-10-03 02:15:26.661496', '2025-10-03 02:15:26.661496')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:15:26 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 597)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (9.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:16:13.148091', '2025-10-03 02:16:13.148091'), (2, 'Theo Becker', 0, '2025-10-03 02:16:13.148091', '2025-10-03 02:16:13.148091')[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:16:13 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 597)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (8.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:16:22.578163', '2025-10-03 02:16:22.578163'), (2, 'Theo Becker', 0, '2025-10-03 02:16:22.578163', '2025-10-03 02:16:22.578163')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:16:22 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 597)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (8.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:17:21.598570', '2025-10-03 02:17:21.598570'), (2, 'Theo Becker', 0, '2025-10-03 02:17:21.598570', '2025-10-03 02:17:21.598570')[0m
  [1m[36mTRANSACTION (4.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:17:21 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 597)
  [1m[35m (0.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:18:08.714517', '2025-10-03 02:18:08.714520') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:18:17.027873', '2025-10-03 02:18:17.027873'), (2, 'Theo Becker', 0, '2025-10-03 02:18:17.027873', '2025-10-03 02:18:17.027873')[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:18:17 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 597)
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Update (2.8ms)[0m  [1m[33mUPDATE "ar_internal_metadata" SET "value" = 'test', "updated_at" = '2025-10-03 02:18:32.540765' WHERE "ar_internal_metadata"."key" = 'environment'[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (11.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:18:35.327978', '2025-10-03 02:18:35.327978'), (2, 'Theo Becker', 0, '2025-10-03 02:18:35.327978', '2025-10-03 02:18:35.327978')[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:18:35 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 597)
  [1m[35m (2.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:21:30.718715', '2025-10-03 02:21:30.718718') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:22:05.488756', '2025-10-03 02:22:05.488758') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (0.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:23:04.314677', '2025-10-03 02:23:04.314679') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (1.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:23:56.003999', '2025-10-03 02:23:56.004003') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Update (2.7ms)[0m  [1m[33mUPDATE "ar_internal_metadata" SET "value" = 'test', "updated_at" = '2025-10-03 02:25:23.254954' WHERE "ar_internal_metadata"."key" = 'environment'[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (8.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "participants" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:25:24.260201', '2025-10-03 02:25:24.260201'), (2, 'Theo Becker', 0, '2025-10-03 02:25:24.260201', '2025-10-03 02:25:24.260201')[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "participants" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:25:24 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 597)
  [1m[35m (35.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (32.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:27:30.563362', '2025-10-03 02:27:30.563365') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:27:30.565494', '2025-10-03 02:27:30.565495') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:27:30.613231', '2025-10-03 02:27:30.613231'), (2, 'Theo Becker', 0, '2025-10-03 02:27:30.613231', '2025-10-03 02:27:30.613231')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:27:30 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 597)
  [1m[36mActiveRecord::InternalMetadata Load (1.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:27:31.877029', '2025-10-03 02:27:31.877029'), (2, 'Theo Becker', 0, '2025-10-03 02:27:31.877029', '2025-10-03 02:27:31.877029')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:27:31 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 597)
  [1m[35m (4.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:27:55.320004', '2025-10-03 02:27:55.320006') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (25.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:27:57.082133', '2025-10-03 02:27:57.082136') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:27:57.084356', '2025-10-03 02:27:57.084358') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:27:57.130748', '2025-10-03 02:27:57.130748'), (2, 'Theo Becker', 0, '2025-10-03 02:27:57.130748', '2025-10-03 02:27:57.130748')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:27:57 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 597)
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:29:35.679340', '2025-10-03 02:29:35.679342') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (31.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (29.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.6ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:29:37.327810', '2025-10-03 02:29:37.327812') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:29:37.329810', '2025-10-03 02:29:37.329811') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:29:37.384856', '2025-10-03 02:29:37.384856'), (2, 'Theo Becker', 0, '2025-10-03 02:29:37.384856', '2025-10-03 02:29:37.384856')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:29:37 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 597)
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:30:36.819325', '2025-10-03 02:30:36.819328') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (25.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (23.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:30:39.090265', '2025-10-03 02:30:39.090268') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:30:39.092278', '2025-10-03 02:30:39.092279') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:30:39.131967', '2025-10-03 02:30:39.131967'), (2, 'Theo Becker', 0, '2025-10-03 02:30:39.131967', '2025-10-03 02:30:39.131967')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:30:39 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 597)
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:32:20.690695', '2025-10-03 02:32:20.690697') RETURNING "key"[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (32.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (26.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:32:22.775117', '2025-10-03 02:32:22.775120') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:32:22.777913', '2025-10-03 02:32:22.777915') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:32:22.816455', '2025-10-03 02:32:22.816455'), (2, 'Theo Becker', 0, '2025-10-03 02:32:22.816455', '2025-10-03 02:32:22.816455')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:32:22 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 597)
  [1m[35m (6.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:33:25.381368', '2025-10-03 02:33:25.381372') RETURNING "key"[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (28.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (24.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:33:27.542799', '2025-10-03 02:33:27.542801') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:33:27.545101', '2025-10-03 02:33:27.545102') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:33:27.597130', '2025-10-03 02:33:27.597130'), (2, 'Theo Becker', 0, '2025-10-03 02:33:27.597130', '2025-10-03 02:33:27.597130')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:33:27 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 597)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (4.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:34:24.151398', '2025-10-03 02:34:24.151402') RETURNING "key"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (34.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:34:26.278520', '2025-10-03 02:34:26.278523') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:34:26.280752', '2025-10-03 02:34:26.280754') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:34:26.335506', '2025-10-03 02:34:26.335506'), (2, 'Theo Becker', 0, '2025-10-03 02:34:26.335506', '2025-10-03 02:34:26.335506')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:34:26 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 597)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (6.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:34:38.283652', '2025-10-03 02:34:38.283658') RETURNING "key"[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (28.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (26.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:34:40.386205', '2025-10-03 02:34:40.386207') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:34:40.388042', '2025-10-03 02:34:40.388043') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:34:40.443677', '2025-10-03 02:34:40.443677'), (2, 'Theo Becker', 0, '2025-10-03 02:34:40.443677', '2025-10-03 02:34:40.443677')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:34:40 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 597)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:50:26.457030', '2025-10-03 02:50:26.457033') RETURNING "key"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (6.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (32.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (27.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:50:28.532955', '2025-10-03 02:50:28.532957') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:50:28.535468', '2025-10-03 02:50:28.535469') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:50:28.589359', '2025-10-03 02:50:28.589359'), (2, 'Theo Becker', 0, '2025-10-03 02:50:28.589359', '2025-10-03 02:50:28.589359')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.9ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:50:28 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.3ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 6ms (ActiveRecord: 1.8ms | Allocations: 3556)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:50:54.079275', '2025-10-03 02:50:54.079275'), (2, 'Theo Becker', 0, '2025-10-03 02:50:54.079275', '2025-10-03 02:50:54.079275')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:50:54 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.9ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 6ms (ActiveRecord: 2.5ms | Allocations: 3556)
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:51:28.651290', '2025-10-03 02:51:28.651292') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (35.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (26.0ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:51:29.786748', '2025-10-03 02:51:29.786750') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:51:29.789938', '2025-10-03 02:51:29.789940') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:51:29.832357', '2025-10-03 02:51:29.832357'), (2, 'Theo Becker', 0, '2025-10-03 02:51:29.832357', '2025-10-03 02:51:29.832357')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:51:29 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.3ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 6ms (ActiveRecord: 1.6ms | Allocations: 3556)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:52:34.315013', '2025-10-03 02:52:34.315015') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (36.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (29.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:52:35.433151', '2025-10-03 02:52:35.433154') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:52:35.438316', '2025-10-03 02:52:35.438320') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:52:35.503197', '2025-10-03 02:52:35.503197'), (2, 'Theo Becker', 0, '2025-10-03 02:52:35.503197', '2025-10-03 02:52:35.503197')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:52:35 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.3ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 5ms (ActiveRecord: 1.7ms | Allocations: 3555)
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (12.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_total_vote_count_on_calling_/participants/1/downvote
-----------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:52:35 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.0ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 2ms (ActiveRecord: 1.2ms | Allocations: 344)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:53:37.768554', '2025-10-03 02:53:37.768556') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (34.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (27.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (7.9ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:53:38.878477', '2025-10-03 02:53:38.878479') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:53:38.881273', '2025-10-03 02:53:38.881275') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:53:38.951248', '2025-10-03 02:53:38.951248'), (2, 'Theo Becker', 0, '2025-10-03 02:53:38.951248', '2025-10-03 02:53:38.951248')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:53:39 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.5ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 5ms (ActiveRecord: 1.8ms | Allocations: 3555)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (14.8ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_total_vote_count_on_calling_/participants/1/downvote
-----------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:53:39 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.0ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 2ms (ActiveRecord: 1.2ms | Allocations: 344)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:54:16.707492', '2025-10-03 02:54:16.707494') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (36.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (27.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:54:17.797121', '2025-10-03 02:54:17.797123') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:54:17.799812', '2025-10-03 02:54:17.799814') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:54:17.857494', '2025-10-03 02:54:17.857494'), (2, 'Theo Becker', 0, '2025-10-03 02:54:17.857494', '2025-10-03 02:54:17.857494')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:54:17 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.5ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 8ms (ActiveRecord: 2.0ms | Allocations: 3555)
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (14.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_total_vote_count_on_calling_/participants/1/downvote
-----------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-02 23:54:18 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 306)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:54:29.537598', '2025-10-03 02:54:29.537600') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (30.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (27.9ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:54:30.637683', '2025-10-03 02:54:30.637686') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:54:30.639734', '2025-10-03 02:54:30.639736') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:54:30.692521', '2025-10-03 02:54:30.692521'), (2, 'Theo Becker', 0, '2025-10-03 02:54:30.692521', '2025-10-03 02:54:30.692521')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_total_vote_count_on_calling_/participants/1/downvote
-----------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-02 23:54:30 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 601)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (20.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:54:30 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (3.0ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 10ms (ActiveRecord: 3.2ms | Allocations: 3265)
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:55:54.651690', '2025-10-03 02:55:54.651692') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (26.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (27.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (1.0ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (7.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:55:55.749914', '2025-10-03 02:55:55.749918') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:55:55.752994', '2025-10-03 02:55:55.752996') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:55:55.832161', '2025-10-03 02:55:55.832161'), (2, 'Theo Becker', 0, '2025-10-03 02:55:55.832161', '2025-10-03 02:55:55.832161')[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:55:55 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (1.4ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 5ms (ActiveRecord: 1.8ms | Allocations: 3506)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (14.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_total_vote_count_on_calling_/participants/1/upvote
---------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mParticipant Update (0.3ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = $1, "updated_at" = $2 WHERE "participants"."id" = $3[0m  [["total_votes", 0], ["updated_at", "2025-10-03 02:55:55.965861"], ["id", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-02 23:55:55 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 0ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 306)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:56:28.143039', '2025-10-03 02:56:28.143042') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (33.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (28.9ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:56:29.327258', '2025-10-03 02:56:29.327261') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:56:29.329710', '2025-10-03 02:56:29.329712') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:56:29.382384', '2025-10-03 02:56:29.382384'), (2, 'Theo Becker', 0, '2025-10-03 02:56:29.382384', '2025-10-03 02:56:29.382384')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_total_vote_count_on_calling_/participants/1/upvote
---------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-02 23:56:29 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 600)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (18.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/1/upvote
-------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:56:29 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (2.6ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 8ms (ActiveRecord: 2.8ms | Allocations: 3218)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (6.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:57:51.421455', '2025-10-03 02:57:51.421458') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (29.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (26.2ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "total_votes" bigint DEFAULT 0, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250928022636)[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-03 02:57:52.549557', '2025-10-03 02:57:52.549559') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'bd150b5c5e6288223b157a7ab9dc7e2c4e7cd2e3', '2025-10-03 02:57:52.551411', '2025-10-03 02:57:52.551412') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "participants";
INSERT INTO "participants" ("id", "name", "total_votes", "created_at", "updated_at") VALUES (1, 'Andressa Urach', 0, '2025-10-03 02:57:52.603183', '2025-10-03 02:57:52.603183'), (2, 'Theo Becker', 0, '2025-10-03 02:57:52.603183', '2025-10-03 02:57:52.603183')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_total_vote_count_on_calling_/participants/{id}/upvote_on_non-existing_id
-------------------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-02 23:57:52 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 600)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (17.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_total_vote_count_on_calling_/participants/{id}/upvote
----------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-02 23:57:52 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
  [1m[36mParticipant Update All (2.6ms)[0m  [1m[33mUPDATE "participants" SET "total_votes" = COALESCE("total_votes", 0) + $1 WHERE "participants"."id" = $2[0m  [["total_votes", 1], ["id", 1]]
Completed 204 No Content in 6ms (ActiveRecord: 2.8ms | Allocations: 3218)
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:06:52.926042', '2025-10-04 21:06:52.926044') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (34.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (5.4ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:06:54.150843', '2025-10-04 21:06:54.150846') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:06:54.153283', '2025-10-04 21:06:54.153285') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:11:06.178128', '2025-10-04 21:11:06.178128'), (2, 'Theo Becker', '2025-10-04 21:11:06.178128', '2025-10-04 21:11:06.178128');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 980190962, '2025-10-04 21:11:06.182597', '2025-10-04 21:11:06.182597'), (298486374, 298486374, '2025-10-04 21:11:06.182597', '2025-10-04 21:11:06.182597')[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:11:06.212497', '2025-10-04 21:11:06.212497'), (2, 'Theo Becker', '2025-10-04 21:11:06.212497', '2025-10-04 21:11:06.212497');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 980190962, '2025-10-04 21:11:06.212538', '2025-10-04 21:11:06.212538'), (298486374, 298486374, '2025-10-04 21:11:06.212538', '2025-10-04 21:11:06.212538')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:12:43.785076', '2025-10-04 21:12:43.785076'), (2, 'Theo Becker', '2025-10-04 21:12:43.785076', '2025-10-04 21:12:43.785076');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 64810937, '2025-10-04 21:12:43.789948', '2025-10-04 21:12:43.789948'), (298486374, 450215437, '2025-10-04 21:12:43.789948', '2025-10-04 21:12:43.789948')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:12:43.824504', '2025-10-04 21:12:43.824504'), (2, 'Theo Becker', '2025-10-04 21:12:43.824504', '2025-10-04 21:12:43.824504');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 64810937, '2025-10-04 21:12:43.824545', '2025-10-04 21:12:43.824545'), (298486374, 450215437, '2025-10-04 21:12:43.824545', '2025-10-04 21:12:43.824545')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:13:52.064283', '2025-10-04 21:13:52.064283'), (2, 'Theo Becker', '2025-10-04 21:13:52.064283', '2025-10-04 21:13:52.064283');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 980190962, '2025-10-04 21:13:52.069832', '2025-10-04 21:13:52.069832'), (298486374, 298486374, '2025-10-04 21:13:52.069832', '2025-10-04 21:13:52.069832')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:13:52.113002', '2025-10-04 21:13:52.113002'), (2, 'Theo Becker', '2025-10-04 21:13:52.113002', '2025-10-04 21:13:52.113002');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 980190962, '2025-10-04 21:13:52.113044', '2025-10-04 21:13:52.113044'), (298486374, 298486374, '2025-10-04 21:13:52.113044', '2025-10-04 21:13:52.113044')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:14:40.391595', '2025-10-04 21:14:40.391595'), (2, 'Theo Becker', '2025-10-04 21:14:40.391595', '2025-10-04 21:14:40.391595');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:14:40.397647', '2025-10-04 21:14:40.397647'), (298486374, 2, '2025-10-04 21:14:40.397647', '2025-10-04 21:14:40.397647')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:14:40 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: ff0e836c-4d42-4d57-884e-7ebb96e408d5) to Test(default) with arguments: #<GlobalID:0x000078530c04b668 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 9ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 4647)
  [1m[36mVote Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (17.9ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:14:40 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 201)
  [1m[36mVote Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:16:18.581037', '2025-10-04 21:16:18.581037'), (2, 'Theo Becker', '2025-10-04 21:16:18.581037', '2025-10-04 21:16:18.581037');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:16:18.585924', '2025-10-04 21:16:18.585924'), (298486374, 2, '2025-10-04 21:16:18.585924', '2025-10-04 21:16:18.585924')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:16:18 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: f227f7a4-e4cc-4ff0-b42c-80341b686bbf) to Test(default) with arguments: #<GlobalID:0x00007b0395a5da98 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [f227f7a4-e4cc-4ff0-b42c-80341b686bbf]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [f227f7a4-e4cc-4ff0-b42c-80341b686bbf] Performing UpvoteJob (Job ID: f227f7a4-e4cc-4ff0-b42c-80341b686bbf) from Test(default) enqueued at 2025-10-04T21:16:18.674851910Z with arguments: #<GlobalID:0x00007b03967d5130 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [f227f7a4-e4cc-4ff0-b42c-80341b686bbf]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [f227f7a4-e4cc-4ff0-b42c-80341b686bbf]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:16:18.888219"], ["updated_at", "2025-10-04 21:16:18.888219"]]
[ActiveJob] [UpvoteJob] [f227f7a4-e4cc-4ff0-b42c-80341b686bbf]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [f227f7a4-e4cc-4ff0-b42c-80341b686bbf] Performed UpvoteJob (Job ID: f227f7a4-e4cc-4ff0-b42c-80341b686bbf) from Test(default) in 215.33ms
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (13.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:16:18 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 201)
  [1m[36mVote Count (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:16:55.948468', '2025-10-04 21:16:55.948468'), (2, 'Theo Becker', '2025-10-04 21:16:55.948468', '2025-10-04 21:16:55.948468');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:16:55.952841', '2025-10-04 21:16:55.952841'), (298486374, 2, '2025-10-04 21:16:55.952841', '2025-10-04 21:16:55.952841')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:16:56 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 4a88b33f-9b73-4a61-a1d6-fc4018582703) to Test(default) with arguments: #<GlobalID:0x000074bcc8e00340 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [4a88b33f-9b73-4a61-a1d6-fc4018582703]   [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [4a88b33f-9b73-4a61-a1d6-fc4018582703] Performing UpvoteJob (Job ID: 4a88b33f-9b73-4a61-a1d6-fc4018582703) from Test(default) enqueued at 2025-10-04T21:16:56.044620867Z with arguments: #<GlobalID:0x000074bcc90b2a70 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [4a88b33f-9b73-4a61-a1d6-fc4018582703]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [4a88b33f-9b73-4a61-a1d6-fc4018582703]   [1m[36mVote Create (1.5ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:16:56.165184"], ["updated_at", "2025-10-04 21:16:56.165184"]]
[ActiveJob] [UpvoteJob] [4a88b33f-9b73-4a61-a1d6-fc4018582703]   [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [4a88b33f-9b73-4a61-a1d6-fc4018582703] Performed UpvoteJob (Job ID: 4a88b33f-9b73-4a61-a1d6-fc4018582703) from Test(default) in 124.34ms
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (21.8ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:16:56 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 201)
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:32:55.700103', '2025-10-04 21:32:55.700103'), (2, 'Theo Becker', '2025-10-04 21:32:55.700103', '2025-10-04 21:32:55.700103');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:32:55.704367', '2025-10-04 21:32:55.704367'), (298486374, 2, '2025-10-04 21:32:55.704367', '2025-10-04 21:32:55.704367')[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (16.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:32:55 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 598)
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (13.9ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:32:55 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 9f041c72-26e1-4543-bee6-5ce3c110b761) to Test(default) with arguments: #<GlobalID:0x00007bc459d42008 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 5ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 3493)
[ActiveJob] [UpvoteJob] [9f041c72-26e1-4543-bee6-5ce3c110b761]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [9f041c72-26e1-4543-bee6-5ce3c110b761] Performing UpvoteJob (Job ID: 9f041c72-26e1-4543-bee6-5ce3c110b761) from Test(default) enqueued at 2025-10-04T21:32:55.872996239Z with arguments: #<GlobalID:0x00007bc459d2ac28 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [9f041c72-26e1-4543-bee6-5ce3c110b761]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [9f041c72-26e1-4543-bee6-5ce3c110b761]   [1m[36mVote Create (1.5ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:32:56.061031"], ["updated_at", "2025-10-04 21:32:56.061031"]]
[ActiveJob] [UpvoteJob] [9f041c72-26e1-4543-bee6-5ce3c110b761]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [9f041c72-26e1-4543-bee6-5ce3c110b761] Performed UpvoteJob (Job ID: 9f041c72-26e1-4543-bee6-5ce3c110b761) from Test(default) in 191.05ms
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:32:56.646290', '2025-10-04 21:32:56.646290'), (2, 'Theo Becker', '2025-10-04 21:32:56.646290', '2025-10-04 21:32:56.646290');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:32:56.650605', '2025-10-04 21:32:56.650605'), (298486374, 2, '2025-10-04 21:32:56.650605', '2025-10-04 21:32:56.650605')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
UpvoteJobTest - test_it_should_update_votes_count: NoMethodError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_enqueued_jobs`) can be used, as long as `assert_raises` is inside their block.

  [1m[35m (2.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:33:47.690643', '2025-10-04 21:33:47.690647') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.4ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (30.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (24.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:33:48.922623', '2025-10-04 21:33:48.922627') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:33:48.925835', '2025-10-04 21:33:48.925837') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:33:48.992761', '2025-10-04 21:33:48.992761'), (2, 'Theo Becker', '2025-10-04 21:33:48.992761', '2025-10-04 21:33:48.992761');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:33:49.015316', '2025-10-04 21:33:49.015316'), (298486374, 2, '2025-10-04 21:33:49.015316', '2025-10-04 21:33:49.015316')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:33:49 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 4497ac6e-e196-43de-9c00-fcbc99057c14) to Test(default) with arguments: #<GlobalID:0x00007bb8b42b3318 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 6ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 3899)
[ActiveJob] [UpvoteJob] [4497ac6e-e196-43de-9c00-fcbc99057c14]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [4497ac6e-e196-43de-9c00-fcbc99057c14] Performing UpvoteJob (Job ID: 4497ac6e-e196-43de-9c00-fcbc99057c14) from Test(default) enqueued at 2025-10-04T21:33:49.113416646Z with arguments: #<GlobalID:0x00007bb8b4f84290 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [4497ac6e-e196-43de-9c00-fcbc99057c14]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [4497ac6e-e196-43de-9c00-fcbc99057c14]   [1m[36mVote Create (1.6ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:33:49.247372"], ["updated_at", "2025-10-04 21:33:49.247372"]]
[ActiveJob] [UpvoteJob] [4497ac6e-e196-43de-9c00-fcbc99057c14]   [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [4497ac6e-e196-43de-9c00-fcbc99057c14] Performed UpvoteJob (Job ID: 4497ac6e-e196-43de-9c00-fcbc99057c14) from Test(default) in 138.24ms
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (13.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:33:49 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms | Allocations: 201)
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:33:49.858890', '2025-10-04 21:33:49.858890'), (2, 'Theo Becker', '2025-10-04 21:33:49.858890', '2025-10-04 21:33:49.858890');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:33:49.864481', '2025-10-04 21:33:49.864481'), (298486374, 2, '2025-10-04 21:33:49.864481', '2025-10-04 21:33:49.864481')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
UpvoteJobTest - test_it_should_update_votes_count: NoMethodError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_enqueued_jobs`) can be used, as long as `assert_raises` is inside their block.

  [1m[35m (2.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:34:47.656991', '2025-10-04 21:34:47.656994') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (29.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (28.2ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:34:48.853626', '2025-10-04 21:34:48.853628') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:34:48.855572', '2025-10-04 21:34:48.855573') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:34:48.915932', '2025-10-04 21:34:48.915932'), (2, 'Theo Becker', '2025-10-04 21:34:48.915932', '2025-10-04 21:34:48.915932');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:34:48.939153', '2025-10-04 21:34:48.939153'), (298486374, 2, '2025-10-04 21:34:48.939153', '2025-10-04 21:34:48.939153')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:34:49 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 0c46661c-a39b-41c9-aef1-c57a935629e4) to Test(default) with arguments: #<GlobalID:0x00007a508354f648 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [0c46661c-a39b-41c9-aef1-c57a935629e4]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [0c46661c-a39b-41c9-aef1-c57a935629e4] Performing UpvoteJob (Job ID: 0c46661c-a39b-41c9-aef1-c57a935629e4) from Test(default) enqueued at 2025-10-04T21:34:49.050817833Z with arguments: #<GlobalID:0x00007a50841f21e8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [0c46661c-a39b-41c9-aef1-c57a935629e4]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [0c46661c-a39b-41c9-aef1-c57a935629e4]   [1m[36mVote Create (1.3ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:34:49.182391"], ["updated_at", "2025-10-04 21:34:49.182391"]]
[ActiveJob] [UpvoteJob] [0c46661c-a39b-41c9-aef1-c57a935629e4]   [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [0c46661c-a39b-41c9-aef1-c57a935629e4] Performed UpvoteJob (Job ID: 0c46661c-a39b-41c9-aef1-c57a935629e4) from Test(default) in 135.12ms
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (15.8ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:34:49 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 201)
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:34:49.805863', '2025-10-04 21:34:49.805863'), (2, 'Theo Becker', '2025-10-04 21:34:49.805863', '2025-10-04 21:34:49.805863');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:34:49.810299', '2025-10-04 21:34:49.810299'), (298486374, 2, '2025-10-04 21:34:49.810299', '2025-10-04 21:34:49.810299')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
UpvoteJobTest - test_it_should_update_votes_count: NoMethodError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_enqueued_jobs`) can be used, as long as `assert_raises` is inside their block.

  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:35:43.639126', '2025-10-04 21:35:43.639128') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (29.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.8ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:35:44.868015', '2025-10-04 21:35:44.868017') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:35:44.870171', '2025-10-04 21:35:44.870172') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:35:44.944748', '2025-10-04 21:35:44.944748'), (2, 'Theo Becker', '2025-10-04 21:35:44.944748', '2025-10-04 21:35:44.944748');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:35:44.966311', '2025-10-04 21:35:44.966311'), (298486374, 2, '2025-10-04 21:35:44.966311', '2025-10-04 21:35:44.966311')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:35:45 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 598)
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (13.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:35:45 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 20f451b9-a373-412b-a1c8-bc96287e00dc) to Test(default) with arguments: #<GlobalID:0x00007fecf258f2c8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 5ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 3492)
[ActiveJob] [UpvoteJob] [20f451b9-a373-412b-a1c8-bc96287e00dc]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [20f451b9-a373-412b-a1c8-bc96287e00dc] Performing UpvoteJob (Job ID: 20f451b9-a373-412b-a1c8-bc96287e00dc) from Test(default) enqueued at 2025-10-04T21:35:45.126843821Z with arguments: #<GlobalID:0x00007fecf2587f28 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [20f451b9-a373-412b-a1c8-bc96287e00dc]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [20f451b9-a373-412b-a1c8-bc96287e00dc]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:35:45.282887"], ["updated_at", "2025-10-04 21:35:45.282887"]]
[ActiveJob] [UpvoteJob] [20f451b9-a373-412b-a1c8-bc96287e00dc]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [20f451b9-a373-412b-a1c8-bc96287e00dc] Performed UpvoteJob (Job ID: 20f451b9-a373-412b-a1c8-bc96287e00dc) from Test(default) in 158.38ms
  [1m[36mVote Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:35:45.875688', '2025-10-04 21:35:45.875688'), (2, 'Theo Becker', '2025-10-04 21:35:45.875688', '2025-10-04 21:35:45.875688');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:35:45.882476', '2025-10-04 21:35:45.882476'), (298486374, 2, '2025-10-04 21:35:45.882476', '2025-10-04 21:35:45.882476')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [2294d689-9066-46ac-8641-aaefa2d64536] Performing UpvoteJob (Job ID: 2294d689-9066-46ac-8641-aaefa2d64536) from Test(default) with arguments: 1
[ActiveJob] [UpvoteJob] [2294d689-9066-46ac-8641-aaefa2d64536] Error performing UpvoteJob (Job ID: 2294d689-9066-46ac-8641-aaefa2d64536) from Test(default) in 18.39ms: NoMethodError (undefined method `id' for an instance of Integer):
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/app/jobs/upvote_job.rb:9:in `rescue in perform'
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/app/jobs/upvote_job.rb:4:in `perform'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:68:in `block in _perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:121:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/i18n-1.14.7/lib/i18n.rb:348:in `with_locale'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/translation.rb:9:in `block (2 levels) in <module:Translation>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `instance_exec'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/core_ext/time/zones.rb:65:in `use_zone'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/timezones.rb:9:in `block (2 levels) in <module:Timezones>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `instance_exec'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:141:in `run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:67:in `_perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:32:in `_perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:51:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:26:in `block in perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activerecord-7.1.5.2/lib/active_record/railties/job_runtime.rb:13:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:40:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications.rb:206:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications/instrumenter.rb:58:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications.rb:206:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:39:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activerecord-7.1.5.2/lib/active_record/railties/job_runtime.rb:11:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:26:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:18:in `block in perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:139:in `block in tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:39:in `tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:139:in `tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/broadcast_logger.rb:241:in `method_missing'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:25:in `tag_logger'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:18:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:23:in `perform_now'
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/test/jobs/upvote_job_test.rb:10:in `block in <class:UpvoteJobTest>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:94:in `block (2 levels) in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:190:in `capture_exceptions'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:89:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:368:in `time_it'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:88:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/executor/test_helper.rb:5:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/execution_wrapper.rb:105:in `perform'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/executor/test_helper.rb:5:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:1208:in `run_one_method'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:447:in `run_one_method'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:434:in `block (2 levels) in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:430:in `each'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:430:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:472:in `on_signal'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:459:in `with_info_handler'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:429:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/railties-7.1.5.2/lib/rails/test_unit/line_filtering.rb:10:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `block in __run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `map'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `__run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:288:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:86:in `block in autorun'
  [1m[35m (2.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:36:09.014036', '2025-10-04 21:36:09.014038') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (31.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (30.8ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (3.1ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:36:10.261649', '2025-10-04 21:36:10.261652') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:36:10.264408', '2025-10-04 21:36:10.264411') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:36:10.333550', '2025-10-04 21:36:10.333550'), (2, 'Theo Becker', '2025-10-04 21:36:10.333550', '2025-10-04 21:36:10.333550');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:36:10.356570', '2025-10-04 21:36:10.356570'), (298486374, 2, '2025-10-04 21:36:10.356570', '2025-10-04 21:36:10.356570')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:36:10 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 70272592-7955-4a09-93bb-d0faff93c79b) to Test(default) with arguments: #<GlobalID:0x00007291e0212250 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 3899)
[ActiveJob] [UpvoteJob] [70272592-7955-4a09-93bb-d0faff93c79b]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [70272592-7955-4a09-93bb-d0faff93c79b] Performing UpvoteJob (Job ID: 70272592-7955-4a09-93bb-d0faff93c79b) from Test(default) enqueued at 2025-10-04T21:36:10.453041152Z with arguments: #<GlobalID:0x00007291e04b0bb0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [70272592-7955-4a09-93bb-d0faff93c79b]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [70272592-7955-4a09-93bb-d0faff93c79b]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:36:10.587378"], ["updated_at", "2025-10-04 21:36:10.587378"]]
[ActiveJob] [UpvoteJob] [70272592-7955-4a09-93bb-d0faff93c79b]   [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [70272592-7955-4a09-93bb-d0faff93c79b] Performed UpvoteJob (Job ID: 70272592-7955-4a09-93bb-d0faff93c79b) from Test(default) in 137.53ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (16.6ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:36:10 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms | Allocations: 201)
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:36:11.187072', '2025-10-04 21:36:11.187072'), (2, 'Theo Becker', '2025-10-04 21:36:11.187072', '2025-10-04 21:36:11.187072');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:36:11.191543', '2025-10-04 21:36:11.191543'), (298486374, 2, '2025-10-04 21:36:11.191543', '2025-10-04 21:36:11.191543')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [bf91eddb-7e7f-4cf4-959a-6ac0a7d3146f] Performing UpvoteJob (Job ID: bf91eddb-7e7f-4cf4-959a-6ac0a7d3146f) from Test(default) with arguments: 1
[ActiveJob] [UpvoteJob] [bf91eddb-7e7f-4cf4-959a-6ac0a7d3146f] Error performing UpvoteJob (Job ID: bf91eddb-7e7f-4cf4-959a-6ac0a7d3146f) from Test(default) in 13.07ms: NoMethodError (undefined method `id' for an instance of Integer):
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/app/jobs/upvote_job.rb:9:in `rescue in perform'
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/app/jobs/upvote_job.rb:4:in `perform'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:68:in `block in _perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:121:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/i18n-1.14.7/lib/i18n.rb:348:in `with_locale'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/translation.rb:9:in `block (2 levels) in <module:Translation>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `instance_exec'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/core_ext/time/zones.rb:65:in `use_zone'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/timezones.rb:9:in `block (2 levels) in <module:Timezones>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `instance_exec'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:141:in `run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:67:in `_perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:32:in `_perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:51:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:26:in `block in perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activerecord-7.1.5.2/lib/active_record/railties/job_runtime.rb:13:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:40:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications.rb:206:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications/instrumenter.rb:58:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications.rb:206:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:39:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activerecord-7.1.5.2/lib/active_record/railties/job_runtime.rb:11:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:26:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:18:in `block in perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:139:in `block in tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:39:in `tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:139:in `tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/broadcast_logger.rb:241:in `method_missing'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:25:in `tag_logger'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:18:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:23:in `perform_now'
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/test/jobs/upvote_job_test.rb:10:in `block in <class:UpvoteJobTest>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:94:in `block (2 levels) in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:190:in `capture_exceptions'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:89:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:368:in `time_it'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:88:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/executor/test_helper.rb:5:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/execution_wrapper.rb:105:in `perform'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/executor/test_helper.rb:5:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:1208:in `run_one_method'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:447:in `run_one_method'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:434:in `block (2 levels) in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:430:in `each'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:430:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:472:in `on_signal'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:459:in `with_info_handler'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:429:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/railties-7.1.5.2/lib/rails/test_unit/line_filtering.rb:10:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `block in __run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `map'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `__run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:288:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:86:in `block in autorun'
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:36:38.702594', '2025-10-04 21:36:38.702596') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (27.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (24.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:36:39.937811', '2025-10-04 21:36:39.937815') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:36:39.940966', '2025-10-04 21:36:39.940968') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:36:40.001447', '2025-10-04 21:36:40.001447'), (2, 'Theo Becker', '2025-10-04 21:36:40.001447', '2025-10-04 21:36:40.001447');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:36:40.026893', '2025-10-04 21:36:40.026893'), (298486374, 2, '2025-10-04 21:36:40.026893', '2025-10-04 21:36:40.026893')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:36:40 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 6297efbb-b951-4083-84e8-9b6708ef4d9c) to Test(default) with arguments: #<GlobalID:0x000076e7086f80e0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 6ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 3899)
[ActiveJob] [UpvoteJob] [6297efbb-b951-4083-84e8-9b6708ef4d9c]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [6297efbb-b951-4083-84e8-9b6708ef4d9c] Performing UpvoteJob (Job ID: 6297efbb-b951-4083-84e8-9b6708ef4d9c) from Test(default) enqueued at 2025-10-04T21:36:40.139446402Z with arguments: #<GlobalID:0x000076e70a394820 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [6297efbb-b951-4083-84e8-9b6708ef4d9c]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [6297efbb-b951-4083-84e8-9b6708ef4d9c]   [1m[36mVote Create (1.2ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:36:40.271394"], ["updated_at", "2025-10-04 21:36:40.271394"]]
[ActiveJob] [UpvoteJob] [6297efbb-b951-4083-84e8-9b6708ef4d9c]   [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [6297efbb-b951-4083-84e8-9b6708ef4d9c] Performed UpvoteJob (Job ID: 6297efbb-b951-4083-84e8-9b6708ef4d9c) from Test(default) in 135.26ms
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (15.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:36:40 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 201)
  [1m[36mVote Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:36:40.871920', '2025-10-04 21:36:40.871920'), (2, 'Theo Becker', '2025-10-04 21:36:40.871920', '2025-10-04 21:36:40.871920');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:36:40.876408', '2025-10-04 21:36:40.876408'), (298486374, 2, '2025-10-04 21:36:40.876408', '2025-10-04 21:36:40.876408')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [cb48ef75-62e8-415a-9a1f-60290f6a3c36] Performing UpvoteJob (Job ID: cb48ef75-62e8-415a-9a1f-60290f6a3c36) from Test(default) with arguments: 1
[ActiveJob] [UpvoteJob] [cb48ef75-62e8-415a-9a1f-60290f6a3c36] Error performing UpvoteJob (Job ID: cb48ef75-62e8-415a-9a1f-60290f6a3c36) from Test(default) in 13.14ms: NoMethodError (undefined method `id' for an instance of Integer):
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/app/jobs/upvote_job.rb:9:in `rescue in perform'
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/app/jobs/upvote_job.rb:4:in `perform'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:68:in `block in _perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:121:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/i18n-1.14.7/lib/i18n.rb:348:in `with_locale'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/translation.rb:9:in `block (2 levels) in <module:Translation>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `instance_exec'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/core_ext/time/zones.rb:65:in `use_zone'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/timezones.rb:9:in `block (2 levels) in <module:Timezones>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `instance_exec'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:130:in `block in run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/callbacks.rb:141:in `run_callbacks'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:67:in `_perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:32:in `_perform_job'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:51:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:26:in `block in perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activerecord-7.1.5.2/lib/active_record/railties/job_runtime.rb:13:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:40:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications.rb:206:in `block in instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications/instrumenter.rb:58:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/notifications.rb:206:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:39:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activerecord-7.1.5.2/lib/active_record/railties/job_runtime.rb:11:in `instrument'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/instrumentation.rb:26:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:18:in `block in perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:139:in `block in tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:39:in `tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/tagged_logging.rb:139:in `tagged'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/broadcast_logger.rb:241:in `method_missing'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:25:in `tag_logger'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/logging.rb:18:in `perform_now'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activejob-7.1.5.2/lib/active_job/execution.rb:23:in `perform_now'
/home/arthurfernandes/Code/Personal/teste_tecnico_laager/teste_tecnico_laager_backend/test/jobs/upvote_job_test.rb:10:in `block in <class:UpvoteJobTest>'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:94:in `block (2 levels) in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:190:in `capture_exceptions'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:89:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:368:in `time_it'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest/test.rb:88:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/executor/test_helper.rb:5:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/execution_wrapper.rb:105:in `perform'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/activesupport-7.1.5.2/lib/active_support/executor/test_helper.rb:5:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:1208:in `run_one_method'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:447:in `run_one_method'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:434:in `block (2 levels) in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:430:in `each'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:430:in `block in run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:472:in `on_signal'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:459:in `with_info_handler'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:429:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/railties-7.1.5.2/lib/rails/test_unit/line_filtering.rb:10:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `block in __run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `map'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:332:in `__run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:288:in `run'
/home/arthurfernandes/.local/share/mise/installs/ruby/3.3.9/lib/ruby/gems/3.3.0/gems/minitest-5.25.5/lib/minitest.rb:86:in `block in autorun'
  [1m[35m (2.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:37:19.470943', '2025-10-04 21:37:19.470946') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (30.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (6.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:37:20.730542', '2025-10-04 21:37:20.730544') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:37:20.732984', '2025-10-04 21:37:20.732985') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:37:20.796439', '2025-10-04 21:37:20.796439'), (2, 'Theo Becker', '2025-10-04 21:37:20.796439', '2025-10-04 21:37:20.796439');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:37:20.814809', '2025-10-04 21:37:20.814809'), (298486374, 2, '2025-10-04 21:37:20.814809', '2025-10-04 21:37:20.814809')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:37:20 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 598)
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (17.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:37:20 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 21baceb3-1328-4665-b720-c8ca7f282461) to Test(default) with arguments: #<GlobalID:0x00007b049812f0a8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 3492)
[ActiveJob] [UpvoteJob] [21baceb3-1328-4665-b720-c8ca7f282461]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [21baceb3-1328-4665-b720-c8ca7f282461] Performing UpvoteJob (Job ID: 21baceb3-1328-4665-b720-c8ca7f282461) from Test(default) enqueued at 2025-10-04T21:37:20.963857367Z with arguments: #<GlobalID:0x00007b0498127d08 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [21baceb3-1328-4665-b720-c8ca7f282461]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [21baceb3-1328-4665-b720-c8ca7f282461]   [1m[36mVote Create (1.4ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:37:21.095408"], ["updated_at", "2025-10-04 21:37:21.095408"]]
[ActiveJob] [UpvoteJob] [21baceb3-1328-4665-b720-c8ca7f282461]   [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [21baceb3-1328-4665-b720-c8ca7f282461] Performed UpvoteJob (Job ID: 21baceb3-1328-4665-b720-c8ca7f282461) from Test(default) in 135.87ms
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:37:21.650899', '2025-10-04 21:37:21.650899'), (2, 'Theo Becker', '2025-10-04 21:37:21.650899', '2025-10-04 21:37:21.650899');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:37:21.655536', '2025-10-04 21:37:21.655536'), (298486374, 2, '2025-10-04 21:37:21.655536', '2025-10-04 21:37:21.655536')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [e15dbfee-f010-4566-a995-e56e18386536] Performing UpvoteJob (Job ID: e15dbfee-f010-4566-a995-e56e18386536) from Test(default) with arguments: #<GlobalID:0x00007f4ec4d14588 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [e15dbfee-f010-4566-a995-e56e18386536]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [e15dbfee-f010-4566-a995-e56e18386536]   [1m[36mVote Create (2.3ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:37:21.713938"], ["updated_at", "2025-10-04 21:37:21.713938"]]
[ActiveJob] [UpvoteJob] [e15dbfee-f010-4566-a995-e56e18386536]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [e15dbfee-f010-4566-a995-e56e18386536] Performed UpvoteJob (Job ID: e15dbfee-f010-4566-a995-e56e18386536) from Test(default) in 15.48ms
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:38:00.426006', '2025-10-04 21:38:00.426008') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (29.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (30.8ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.6ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:38:01.660302', '2025-10-04 21:38:01.660307') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:38:01.665385', '2025-10-04 21:38:01.665390') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:38:01.743365', '2025-10-04 21:38:01.743365'), (2, 'Theo Becker', '2025-10-04 21:38:01.743365', '2025-10-04 21:38:01.743365');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:38:01.763806', '2025-10-04 21:38:01.763806'), (298486374, 2, '2025-10-04 21:38:01.763806', '2025-10-04 21:38:01.763806')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:38:01 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 602)
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (15.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:38:01 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: b46a8bbe-8dfc-4b60-979c-66706bbdf394) to Test(default) with arguments: #<GlobalID:0x00007acdc044f300 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 3489)
[ActiveJob] [UpvoteJob] [b46a8bbe-8dfc-4b60-979c-66706bbdf394]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [b46a8bbe-8dfc-4b60-979c-66706bbdf394] Performing UpvoteJob (Job ID: b46a8bbe-8dfc-4b60-979c-66706bbdf394) from Test(default) enqueued at 2025-10-04T21:38:01.899861165Z with arguments: #<GlobalID:0x00007acdc0447f60 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [b46a8bbe-8dfc-4b60-979c-66706bbdf394]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [b46a8bbe-8dfc-4b60-979c-66706bbdf394]   [1m[36mVote Create (1.5ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:38:02.029065"], ["updated_at", "2025-10-04 21:38:02.029065"]]
[ActiveJob] [UpvoteJob] [b46a8bbe-8dfc-4b60-979c-66706bbdf394]   [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [b46a8bbe-8dfc-4b60-979c-66706bbdf394] Performed UpvoteJob (Job ID: b46a8bbe-8dfc-4b60-979c-66706bbdf394) from Test(default) in 133.71ms
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (2.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:38:02.633912', '2025-10-04 21:38:02.633912'), (2, 'Theo Becker', '2025-10-04 21:38:02.633912', '2025-10-04 21:38:02.633912');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:38:02.638816', '2025-10-04 21:38:02.638816'), (298486374, 2, '2025-10-04 21:38:02.638816', '2025-10-04 21:38:02.638816')[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [55e480c3-3dc8-458a-b853-754c13de02a3] Performing UpvoteJob (Job ID: 55e480c3-3dc8-458a-b853-754c13de02a3) from Test(default) with arguments: #<GlobalID:0x00007f341b7edbe0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [55e480c3-3dc8-458a-b853-754c13de02a3]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [55e480c3-3dc8-458a-b853-754c13de02a3]   [1m[36mVote Create (1.5ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:38:02.700003"], ["updated_at", "2025-10-04 21:38:02.700003"]]
[ActiveJob] [UpvoteJob] [55e480c3-3dc8-458a-b853-754c13de02a3]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [55e480c3-3dc8-458a-b853-754c13de02a3] Performed UpvoteJob (Job ID: 55e480c3-3dc8-458a-b853-754c13de02a3) from Test(default) in 15.74ms
  [1m[35m (2.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:38:34.838487', '2025-10-04 21:38:34.838490') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (27.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (26.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:38:36.201050', '2025-10-04 21:38:36.201053') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:38:36.203648', '2025-10-04 21:38:36.203650') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:38:36.258570', '2025-10-04 21:38:36.258570'), (2, 'Theo Becker', '2025-10-04 21:38:36.258570', '2025-10-04 21:38:36.258570');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:38:36.280549', '2025-10-04 21:38:36.280549'), (298486374, 2, '2025-10-04 21:38:36.280549', '2025-10-04 21:38:36.280549')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [1c1fbbfa-a9cf-406c-895c-d5bcd0268ef6] Performing UpvoteJob (Job ID: 1c1fbbfa-a9cf-406c-895c-d5bcd0268ef6) from Test(default) with arguments: #<GlobalID:0x000075f8b19f70c0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [1c1fbbfa-a9cf-406c-895c-d5bcd0268ef6]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [1c1fbbfa-a9cf-406c-895c-d5bcd0268ef6]   [1m[36mVote Create (1.3ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:38:36.329556"], ["updated_at", "2025-10-04 21:38:36.329556"]]
[ActiveJob] [UpvoteJob] [1c1fbbfa-a9cf-406c-895c-d5bcd0268ef6]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [1c1fbbfa-a9cf-406c-895c-d5bcd0268ef6] Performed UpvoteJob (Job ID: 1c1fbbfa-a9cf-406c-895c-d5bcd0268ef6) from Test(default) in 6.48ms
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:38:36.334993', '2025-10-04 21:38:36.334993'), (2, 'Theo Becker', '2025-10-04 21:38:36.334993', '2025-10-04 21:38:36.334993');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:38:36.335036', '2025-10-04 21:38:36.335036'), (298486374, 2, '2025-10-04 21:38:36.335036', '2025-10-04 21:38:36.335036')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:38:36 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 572)
  [1m[36mVote Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (25.9ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:38:36 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 6cf9c4d7-f7c5-4bf6-8d83-6917f439496d) to Test(default) with arguments: #<GlobalID:0x000075f8b1bf56d8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 9ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 3355)
[ActiveJob] [UpvoteJob] [6cf9c4d7-f7c5-4bf6-8d83-6917f439496d]   [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [6cf9c4d7-f7c5-4bf6-8d83-6917f439496d] Performing UpvoteJob (Job ID: 6cf9c4d7-f7c5-4bf6-8d83-6917f439496d) from Test(default) enqueued at 2025-10-04T21:38:36.482106173Z with arguments: #<GlobalID:0x000075f8b1c0c8b0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [6cf9c4d7-f7c5-4bf6-8d83-6917f439496d]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [6cf9c4d7-f7c5-4bf6-8d83-6917f439496d]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:38:36.606172"], ["updated_at", "2025-10-04 21:38:36.606172"]]
[ActiveJob] [UpvoteJob] [6cf9c4d7-f7c5-4bf6-8d83-6917f439496d]   [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [6cf9c4d7-f7c5-4bf6-8d83-6917f439496d] Performed UpvoteJob (Job ID: 6cf9c4d7-f7c5-4bf6-8d83-6917f439496d) from Test(default) in 127.58ms
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:39:09.826378', '2025-10-04 21:39:09.826380') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (33.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (32.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:39:11.130338', '2025-10-04 21:39:11.130341') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:39:11.132324', '2025-10-04 21:39:11.132325') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:39:11.178607', '2025-10-04 21:39:11.178607'), (2, 'Theo Becker', '2025-10-04 21:39:11.178607', '2025-10-04 21:39:11.178607');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:39:11.208877', '2025-10-04 21:39:11.208877'), (298486374, 2, '2025-10-04 21:39:11.208877', '2025-10-04 21:39:11.208877')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.8ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [1de44361-4aac-42ff-b687-bc3a73ad24de] Performing UpvoteJob (Job ID: 1de44361-4aac-42ff-b687-bc3a73ad24de) from Test(default) with arguments: #<GlobalID:0x00007d2375193690 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [1de44361-4aac-42ff-b687-bc3a73ad24de]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [1de44361-4aac-42ff-b687-bc3a73ad24de]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:39:11.265816"], ["updated_at", "2025-10-04 21:39:11.265816"]]
[ActiveJob] [UpvoteJob] [1de44361-4aac-42ff-b687-bc3a73ad24de]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [1de44361-4aac-42ff-b687-bc3a73ad24de] Performed UpvoteJob (Job ID: 1de44361-4aac-42ff-b687-bc3a73ad24de) from Test(default) in 5.59ms
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:39:11.270135', '2025-10-04 21:39:11.270135'), (2, 'Theo Becker', '2025-10-04 21:39:11.270135', '2025-10-04 21:39:11.270135');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:39:11.270176', '2025-10-04 21:39:11.270176'), (298486374, 2, '2025-10-04 21:39:11.270176', '2025-10-04 21:39:11.270176')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:39:11 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 572)
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (25.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:39:11 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: b29e9b24-21bb-405a-aba4-996d6a13c8f1) to Test(default) with arguments: #<GlobalID:0x00007d2376cc8758 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 3355)
[ActiveJob] [UpvoteJob] [b29e9b24-21bb-405a-aba4-996d6a13c8f1]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [b29e9b24-21bb-405a-aba4-996d6a13c8f1] Performing UpvoteJob (Job ID: b29e9b24-21bb-405a-aba4-996d6a13c8f1) from Test(default) enqueued at 2025-10-04T21:39:11.399470628Z with arguments: #<GlobalID:0x00007d23767f2670 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [b29e9b24-21bb-405a-aba4-996d6a13c8f1]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [b29e9b24-21bb-405a-aba4-996d6a13c8f1]   [1m[36mVote Create (1.3ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:39:11.520704"], ["updated_at", "2025-10-04 21:39:11.520704"]]
[ActiveJob] [UpvoteJob] [b29e9b24-21bb-405a-aba4-996d6a13c8f1]   [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [b29e9b24-21bb-405a-aba4-996d6a13c8f1] Performed UpvoteJob (Job ID: b29e9b24-21bb-405a-aba4-996d6a13c8f1) from Test(default) in 124.8ms
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:40:39.275345', '2025-10-04 21:40:39.275349') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (34.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (30.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (3.8ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:40:40.556844', '2025-10-04 21:40:40.556848') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:40:40.560953', '2025-10-04 21:40:40.560956') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:40:40.618551', '2025-10-04 21:40:40.618551'), (2, 'Theo Becker', '2025-10-04 21:40:40.618551', '2025-10-04 21:40:40.618551');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:40:40.639065', '2025-10-04 21:40:40.639065'), (298486374, 2, '2025-10-04 21:40:40.639065', '2025-10-04 21:40:40.639065')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:40:40 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: c1fca461-435f-4173-8648-8e26035bb7f4) to Test(default) with arguments: #<GlobalID:0x000073b5c897c1a0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 5ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 3899)
[ActiveJob] [UpvoteJob] [c1fca461-435f-4173-8648-8e26035bb7f4]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [c1fca461-435f-4173-8648-8e26035bb7f4] Performing UpvoteJob (Job ID: c1fca461-435f-4173-8648-8e26035bb7f4) from Test(default) enqueued at 2025-10-04T21:40:40.743496241Z with arguments: #<GlobalID:0x000073b5c9882e38 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [c1fca461-435f-4173-8648-8e26035bb7f4]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [c1fca461-435f-4173-8648-8e26035bb7f4]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:40:40.879978"], ["updated_at", "2025-10-04 21:40:40.879978"]]
[ActiveJob] [UpvoteJob] [c1fca461-435f-4173-8648-8e26035bb7f4]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [c1fca461-435f-4173-8648-8e26035bb7f4] Performed UpvoteJob (Job ID: c1fca461-435f-4173-8648-8e26035bb7f4) from Test(default) in 138.32ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (18.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.7ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:40:40 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 201)
  [1m[36mVote Count (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:40:42.557367', '2025-10-04 21:40:42.557367'), (2, 'Theo Becker', '2025-10-04 21:40:42.557367', '2025-10-04 21:40:42.557367');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:40:42.562015', '2025-10-04 21:40:42.562015'), (298486374, 2, '2025-10-04 21:40:42.562015', '2025-10-04 21:40:42.562015')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [1481d3e8-6b87-4284-892c-2c360d5a012c] Performing UpvoteJob (Job ID: 1481d3e8-6b87-4284-892c-2c360d5a012c) from Test(default) with arguments: #<GlobalID:0x00007e5ec014cec0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [1481d3e8-6b87-4284-892c-2c360d5a012c]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [1481d3e8-6b87-4284-892c-2c360d5a012c]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:40:42.625160"], ["updated_at", "2025-10-04 21:40:42.625160"]]
[ActiveJob] [UpvoteJob] [1481d3e8-6b87-4284-892c-2c360d5a012c]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [1481d3e8-6b87-4284-892c-2c360d5a012c] Performed UpvoteJob (Job ID: 1481d3e8-6b87-4284-892c-2c360d5a012c) from Test(default) in 19.13ms
  [1m[35m (2.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:41:12.129141', '2025-10-04 21:41:12.129143') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (29.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (33.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.6ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (8.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (4.8ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:41:13.371681', '2025-10-04 21:41:13.371683') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:41:13.374432', '2025-10-04 21:41:13.374434') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:41:13.435794', '2025-10-04 21:41:13.435794'), (2, 'Theo Becker', '2025-10-04 21:41:13.435794', '2025-10-04 21:41:13.435794');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:41:13.452636', '2025-10-04 21:41:13.452636'), (298486374, 2, '2025-10-04 21:41:13.452636', '2025-10-04 21:41:13.452636')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:41:13 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 12715f31-0204-4fd9-a864-9d079df71e13) to Test(default) with arguments: #<GlobalID:0x0000712466ec5918 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 5ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [12715f31-0204-4fd9-a864-9d079df71e13]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [12715f31-0204-4fd9-a864-9d079df71e13] Performing UpvoteJob (Job ID: 12715f31-0204-4fd9-a864-9d079df71e13) from Test(default) enqueued at 2025-10-04T21:41:13.543575060Z with arguments: #<GlobalID:0x00007124679d1780 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [12715f31-0204-4fd9-a864-9d079df71e13]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [12715f31-0204-4fd9-a864-9d079df71e13]   [1m[36mVote Create (1.5ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:41:13.675757"], ["updated_at", "2025-10-04 21:41:13.675757"]]
[ActiveJob] [UpvoteJob] [12715f31-0204-4fd9-a864-9d079df71e13]   [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [12715f31-0204-4fd9-a864-9d079df71e13] Performed UpvoteJob (Job ID: 12715f31-0204-4fd9-a864-9d079df71e13) from Test(default) in 136.07ms
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (22.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:41:13 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 0ms (Views: 0.0ms | ActiveRecord: 0.1ms | Allocations: 201)
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:41:15.329367', '2025-10-04 21:41:15.329367'), (2, 'Theo Becker', '2025-10-04 21:41:15.329367', '2025-10-04 21:41:15.329367');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:41:15.336884', '2025-10-04 21:41:15.336884'), (298486374, 2, '2025-10-04 21:41:15.336884', '2025-10-04 21:41:15.336884')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [438a4696-d4c0-43b7-9cd4-9827d43f8def] Performing UpvoteJob (Job ID: 438a4696-d4c0-43b7-9cd4-9827d43f8def) from Test(default) with arguments: #<GlobalID:0x00007b069bf1f848 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [438a4696-d4c0-43b7-9cd4-9827d43f8def]   [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [438a4696-d4c0-43b7-9cd4-9827d43f8def]   [1m[36mVote Create (1.3ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:41:15.403922"], ["updated_at", "2025-10-04 21:41:15.403922"]]
[ActiveJob] [UpvoteJob] [438a4696-d4c0-43b7-9cd4-9827d43f8def]   [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [438a4696-d4c0-43b7-9cd4-9827d43f8def] Performed UpvoteJob (Job ID: 438a4696-d4c0-43b7-9cd4-9827d43f8def) from Test(default) in 23.12ms
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (6.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:41:30.030279', '2025-10-04 21:41:30.030281') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (28.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (29.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.6ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:41:31.247963', '2025-10-04 21:41:31.247966') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:41:31.251477', '2025-10-04 21:41:31.251479') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:41:31.325120', '2025-10-04 21:41:31.325120'), (2, 'Theo Becker', '2025-10-04 21:41:31.325120', '2025-10-04 21:41:31.325120');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:41:31.349038', '2025-10-04 21:41:31.349038'), (298486374, 2, '2025-10-04 21:41:31.349038', '2025-10-04 21:41:31.349038')[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:41:31 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 598)
  [1m[36mVote Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (13.6ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:41:31 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: d6222e22-d9cd-45e0-ae9f-33cc23358e4c) to Test(default) with arguments: #<GlobalID:0x00007b43704bf378 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 3493)
[ActiveJob] [UpvoteJob] [d6222e22-d9cd-45e0-ae9f-33cc23358e4c]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [d6222e22-d9cd-45e0-ae9f-33cc23358e4c] Performing UpvoteJob (Job ID: d6222e22-d9cd-45e0-ae9f-33cc23358e4c) from Test(default) enqueued at 2025-10-04T21:41:31.480737350Z with arguments: #<GlobalID:0x00007b43704b7fd8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [d6222e22-d9cd-45e0-ae9f-33cc23358e4c]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [d6222e22-d9cd-45e0-ae9f-33cc23358e4c]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:41:31.617218"], ["updated_at", "2025-10-04 21:41:31.617218"]]
[ActiveJob] [UpvoteJob] [d6222e22-d9cd-45e0-ae9f-33cc23358e4c]   [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [d6222e22-d9cd-45e0-ae9f-33cc23358e4c] Performed UpvoteJob (Job ID: d6222e22-d9cd-45e0-ae9f-33cc23358e4c) from Test(default) in 140.18ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:41:33.329123', '2025-10-04 21:41:33.329123'), (2, 'Theo Becker', '2025-10-04 21:41:33.329123', '2025-10-04 21:41:33.329123');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:41:33.333964', '2025-10-04 21:41:33.333964'), (298486374, 2, '2025-10-04 21:41:33.333964', '2025-10-04 21:41:33.333964')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [3c016144-b4c7-430f-bca0-4b9739e74638] Performing UpvoteJob (Job ID: 3c016144-b4c7-430f-bca0-4b9739e74638) from Test(default) with arguments: #<GlobalID:0x00007ad7b8245490 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [3c016144-b4c7-430f-bca0-4b9739e74638]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [3c016144-b4c7-430f-bca0-4b9739e74638]   [1m[36mVote Create (1.3ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:41:33.385538"], ["updated_at", "2025-10-04 21:41:33.385538"]]
[ActiveJob] [UpvoteJob] [3c016144-b4c7-430f-bca0-4b9739e74638]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [3c016144-b4c7-430f-bca0-4b9739e74638] Performed UpvoteJob (Job ID: 3c016144-b4c7-430f-bca0-4b9739e74638) from Test(default) in 17.37ms
  [1m[35m (4.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:42:46.176353', '2025-10-04 21:42:46.176356') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (30.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (30.2ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (1.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (5.7ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (4.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:42:47.443263', '2025-10-04 21:42:47.443268') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:42:47.446592', '2025-10-04 21:42:47.446594') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:42:47.505772', '2025-10-04 21:42:47.505772'), (2, 'Theo Becker', '2025-10-04 21:42:47.505772', '2025-10-04 21:42:47.505772');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:42:47.527728', '2025-10-04 21:42:47.527728'), (298486374, 2, '2025-10-04 21:42:47.527728', '2025-10-04 21:42:47.527728')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:42:47 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 598)
  [1m[36mVote Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (13.8ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.8ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:42:47 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: c325a1c9-ed5c-4a23-b15d-2b5083330850) to Test(default) with arguments: #<GlobalID:0x0000791d6862a468 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 6ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 3493)
[ActiveJob] [UpvoteJob] [c325a1c9-ed5c-4a23-b15d-2b5083330850]   [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [c325a1c9-ed5c-4a23-b15d-2b5083330850] Performing UpvoteJob (Job ID: c325a1c9-ed5c-4a23-b15d-2b5083330850) from Test(default) enqueued at 2025-10-04T21:42:47.679104169Z with arguments: #<GlobalID:0x0000791d686230c8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [c325a1c9-ed5c-4a23-b15d-2b5083330850]   [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [c325a1c9-ed5c-4a23-b15d-2b5083330850]   [1m[36mVote Create (1.8ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:42:47.816864"], ["updated_at", "2025-10-04 21:42:47.816864"]]
[ActiveJob] [UpvoteJob] [c325a1c9-ed5c-4a23-b15d-2b5083330850]   [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [c325a1c9-ed5c-4a23-b15d-2b5083330850] Performed UpvoteJob (Job ID: c325a1c9-ed5c-4a23-b15d-2b5083330850) from Test(default) in 142.02ms
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:42:49.527133', '2025-10-04 21:42:49.527133'), (2, 'Theo Becker', '2025-10-04 21:42:49.527133', '2025-10-04 21:42:49.527133');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:42:49.531960', '2025-10-04 21:42:49.531960'), (298486374, 2, '2025-10-04 21:42:49.531960', '2025-10-04 21:42:49.531960')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [19a76ff3-57c3-437b-b24f-376e0a527dab] Performing UpvoteJob (Job ID: 19a76ff3-57c3-437b-b24f-376e0a527dab) from Test(default) with arguments: #<GlobalID:0x000070c797fc2310 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [19a76ff3-57c3-437b-b24f-376e0a527dab]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [19a76ff3-57c3-437b-b24f-376e0a527dab]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:42:49.586510"], ["updated_at", "2025-10-04 21:42:49.586510"]]
[ActiveJob] [UpvoteJob] [19a76ff3-57c3-437b-b24f-376e0a527dab]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [19a76ff3-57c3-437b-b24f-376e0a527dab] Performed UpvoteJob (Job ID: 19a76ff3-57c3-437b-b24f-376e0a527dab) from Test(default) in 16.41ms
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:43:03.363842', '2025-10-04 21:43:03.363844') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (26.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (26.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:43:04.560379', '2025-10-04 21:43:04.560382') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:43:04.562391', '2025-10-04 21:43:04.562392') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:43:04.619702', '2025-10-04 21:43:04.619702'), (2, 'Theo Becker', '2025-10-04 21:43:04.619702', '2025-10-04 21:43:04.619702');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:43:04.637099', '2025-10-04 21:43:04.637099'), (298486374, 2, '2025-10-04 21:43:04.637099', '2025-10-04 21:43:04.637099')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.9ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:43:04 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 598)
  [1m[36mVote Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (18.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (1.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:43:04 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 186e227f-cea7-42e2-8bf9-047d7b23e995) to Test(default) with arguments: #<GlobalID:0x000078d0160bef78 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 3493)
[ActiveJob] [UpvoteJob] [186e227f-cea7-42e2-8bf9-047d7b23e995]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [186e227f-cea7-42e2-8bf9-047d7b23e995] Performing UpvoteJob (Job ID: 186e227f-cea7-42e2-8bf9-047d7b23e995) from Test(default) enqueued at 2025-10-04T21:43:04.785962293Z with arguments: #<GlobalID:0x000078d0160b7bd8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [186e227f-cea7-42e2-8bf9-047d7b23e995]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [186e227f-cea7-42e2-8bf9-047d7b23e995]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:43:04.914710"], ["updated_at", "2025-10-04 21:43:04.914710"]]
[ActiveJob] [UpvoteJob] [186e227f-cea7-42e2-8bf9-047d7b23e995]   [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [186e227f-cea7-42e2-8bf9-047d7b23e995] Performed UpvoteJob (Job ID: 186e227f-cea7-42e2-8bf9-047d7b23e995) from Test(default) in 132.42ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:43:06.622147', '2025-10-04 21:43:06.622147'), (2, 'Theo Becker', '2025-10-04 21:43:06.622147', '2025-10-04 21:43:06.622147');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:43:06.630037', '2025-10-04 21:43:06.630037'), (298486374, 2, '2025-10-04 21:43:06.630037', '2025-10-04 21:43:06.630037')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [1003def4-4c8b-40b6-956e-6feb19e19d95] Performing UpvoteJob (Job ID: 1003def4-4c8b-40b6-956e-6feb19e19d95) from Test(default) with arguments: #<GlobalID:0x00007ef190639128 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [1003def4-4c8b-40b6-956e-6feb19e19d95]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [1003def4-4c8b-40b6-956e-6feb19e19d95]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:43:06.689227"], ["updated_at", "2025-10-04 21:43:06.689227"]]
[ActiveJob] [UpvoteJob] [1003def4-4c8b-40b6-956e-6feb19e19d95]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [1003def4-4c8b-40b6-956e-6feb19e19d95] Performed UpvoteJob (Job ID: 1003def4-4c8b-40b6-956e-6feb19e19d95) from Test(default) in 18.08ms
  [1m[35m (2.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:43:24.757143', '2025-10-04 21:43:24.757146') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.5ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (31.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (28.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:43:25.974830', '2025-10-04 21:43:25.974832') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:43:25.976734', '2025-10-04 21:43:25.976736') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:43:26.050727', '2025-10-04 21:43:26.050727'), (2, 'Theo Becker', '2025-10-04 21:43:26.050727', '2025-10-04 21:43:26.050727');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:43:26.073763', '2025-10-04 21:43:26.073763'), (298486374, 2, '2025-10-04 21:43:26.073763', '2025-10-04 21:43:26.073763')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:43:26 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 717e590e-c979-4826-b7c3-a3c9d6640a75) to Test(default) with arguments: #<GlobalID:0x00007bac04e82cf0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [717e590e-c979-4826-b7c3-a3c9d6640a75]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [717e590e-c979-4826-b7c3-a3c9d6640a75] Performing UpvoteJob (Job ID: 717e590e-c979-4826-b7c3-a3c9d6640a75) from Test(default) enqueued at 2025-10-04T21:43:26.176272241Z with arguments: #<GlobalID:0x00007bac05cfd370 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [717e590e-c979-4826-b7c3-a3c9d6640a75]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [717e590e-c979-4826-b7c3-a3c9d6640a75]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:43:26.305076"], ["updated_at", "2025-10-04 21:43:26.305076"]]
[ActiveJob] [UpvoteJob] [717e590e-c979-4826-b7c3-a3c9d6640a75]   [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [717e590e-c979-4826-b7c3-a3c9d6640a75] Performed UpvoteJob (Job ID: 717e590e-c979-4826-b7c3-a3c9d6640a75) from Test(default) in 131.94ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[36mTRANSACTION (15.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:43:26 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 201)
  [1m[36mVote Count (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:43:28.004133', '2025-10-04 21:43:28.004133'), (2, 'Theo Becker', '2025-10-04 21:43:28.004133', '2025-10-04 21:43:28.004133');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:43:28.008846', '2025-10-04 21:43:28.008846'), (298486374, 2, '2025-10-04 21:43:28.008846', '2025-10-04 21:43:28.008846')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [a69629af-8ef6-4283-ac5c-90679867c842] Performing UpvoteJob (Job ID: a69629af-8ef6-4283-ac5c-90679867c842) from Test(default) with arguments: #<GlobalID:0x00007dedc11ca0e8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [a69629af-8ef6-4283-ac5c-90679867c842]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [a69629af-8ef6-4283-ac5c-90679867c842]   [1m[36mVote Create (2.2ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:43:28.066510"], ["updated_at", "2025-10-04 21:43:28.066510"]]
[ActiveJob] [UpvoteJob] [a69629af-8ef6-4283-ac5c-90679867c842]   [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [a69629af-8ef6-4283-ac5c-90679867c842] Performed UpvoteJob (Job ID: a69629af-8ef6-4283-ac5c-90679867c842) from Test(default) in 16.31ms
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (7.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:44:17.575284', '2025-10-04 21:44:17.575289') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (29.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (30.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (6.2ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (2.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:44:18.815339', '2025-10-04 21:44:18.815342') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:44:18.819445', '2025-10-04 21:44:18.819447') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:44:18.890109', '2025-10-04 21:44:18.890109'), (2, 'Theo Becker', '2025-10-04 21:44:18.890109', '2025-10-04 21:44:18.890109');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:44:18.908206', '2025-10-04 21:44:18.908206'), (298486374, 2, '2025-10-04 21:44:18.908206', '2025-10-04 21:44:18.908206')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_fail_to_update_votes_on_calling_/participants/{id}/upvote_on_non-existing_id
--------------------------------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/11/upvote" for 127.0.0.1 at 2025-10-04 18:44:19 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"11"}
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
Participant not found with id 11
Filter chain halted as :set_participant rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 598)
  [1m[36mTRANSACTION (17.7ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:44:19 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: f450b12b-01ef-4c62-bc52-32c35f775ddf) to Test(default) with arguments: #<GlobalID:0x000071da7b4b0df8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 3494)
[ActiveJob] [UpvoteJob] [f450b12b-01ef-4c62-bc52-32c35f775ddf]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [f450b12b-01ef-4c62-bc52-32c35f775ddf] Performing UpvoteJob (Job ID: f450b12b-01ef-4c62-bc52-32c35f775ddf) from Test(default) enqueued at 2025-10-04T21:44:19.065679219Z with arguments: #<GlobalID:0x000071da7b777be0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [f450b12b-01ef-4c62-bc52-32c35f775ddf]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [f450b12b-01ef-4c62-bc52-32c35f775ddf]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:44:19.193717"], ["updated_at", "2025-10-04 21:44:19.193717"]]
[ActiveJob] [UpvoteJob] [f450b12b-01ef-4c62-bc52-32c35f775ddf]   [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [f450b12b-01ef-4c62-bc52-32c35f775ddf] Performed UpvoteJob (Job ID: f450b12b-01ef-4c62-bc52-32c35f775ddf) from Test(default) in 131.7ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:44:20.859730', '2025-10-04 21:44:20.859730'), (2, 'Theo Becker', '2025-10-04 21:44:20.859730', '2025-10-04 21:44:20.859730');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:44:20.864284', '2025-10-04 21:44:20.864284'), (298486374, 2, '2025-10-04 21:44:20.864284', '2025-10-04 21:44:20.864284')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [d31a2e97-a2ea-4558-8981-b51b1ad0fdb6] Performing UpvoteJob (Job ID: d31a2e97-a2ea-4558-8981-b51b1ad0fdb6) from Test(default) with arguments: #<GlobalID:0x00007039ee574d90 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [d31a2e97-a2ea-4558-8981-b51b1ad0fdb6]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [d31a2e97-a2ea-4558-8981-b51b1ad0fdb6]   [1m[36mVote Create (1.7ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:44:20.918607"], ["updated_at", "2025-10-04 21:44:20.918607"]]
[ActiveJob] [UpvoteJob] [d31a2e97-a2ea-4558-8981-b51b1ad0fdb6]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [d31a2e97-a2ea-4558-8981-b51b1ad0fdb6] Performed UpvoteJob (Job ID: d31a2e97-a2ea-4558-8981-b51b1ad0fdb6) from Test(default) in 15.57ms
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:45:44.051429', '2025-10-04 21:45:44.051431') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (29.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (27.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:45:45.294406', '2025-10-04 21:45:45.294409') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:45:45.297231', '2025-10-04 21:45:45.297232') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:45:45.361274', '2025-10-04 21:45:45.361274'), (2, 'Theo Becker', '2025-10-04 21:45:45.361274', '2025-10-04 21:45:45.361274');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:45:45.392156', '2025-10-04 21:45:45.392156'), (298486374, 2, '2025-10-04 21:45:45.392156', '2025-10-04 21:45:45.392156')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:45:45 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 78f0a641-ae39-4fe0-89b3-c69326df9d01) to Test(default) with arguments: #<GlobalID:0x000071d042cb2cd8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [78f0a641-ae39-4fe0-89b3-c69326df9d01]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [78f0a641-ae39-4fe0-89b3-c69326df9d01] Performing UpvoteJob (Job ID: 78f0a641-ae39-4fe0-89b3-c69326df9d01) from Test(default) enqueued at 2025-10-04T21:45:45.501482946Z with arguments: #<GlobalID:0x000071d043c7b340 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [78f0a641-ae39-4fe0-89b3-c69326df9d01]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [78f0a641-ae39-4fe0-89b3-c69326df9d01]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:45:45.631876"], ["updated_at", "2025-10-04 21:45:45.631876"]]
[ActiveJob] [UpvoteJob] [78f0a641-ae39-4fe0-89b3-c69326df9d01]   [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [78f0a641-ae39-4fe0-89b3-c69326df9d01] Performed UpvoteJob (Job ID: 78f0a641-ae39-4fe0-89b3-c69326df9d01) from Test(default) in 133.67ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:45:47.269562', '2025-10-04 21:45:47.269562'), (2, 'Theo Becker', '2025-10-04 21:45:47.269562', '2025-10-04 21:45:47.269562');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:45:47.277146', '2025-10-04 21:45:47.277146'), (298486374, 2, '2025-10-04 21:45:47.277146', '2025-10-04 21:45:47.277146')[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [72f5f18c-4b57-4984-9c18-dbd7355c448f] Performing UpvoteJob (Job ID: 72f5f18c-4b57-4984-9c18-dbd7355c448f) from Test(default) with arguments: #<GlobalID:0x00007c7ad0729990 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [72f5f18c-4b57-4984-9c18-dbd7355c448f]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [72f5f18c-4b57-4984-9c18-dbd7355c448f]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:45:47.341963"], ["updated_at", "2025-10-04 21:45:47.341963"]]
[ActiveJob] [UpvoteJob] [72f5f18c-4b57-4984-9c18-dbd7355c448f]   [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [72f5f18c-4b57-4984-9c18-dbd7355c448f] Performed UpvoteJob (Job ID: 72f5f18c-4b57-4984-9c18-dbd7355c448f) from Test(default) in 17.99ms
  [1m[35m (1.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (7.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:46:58.302929', '2025-10-04 21:46:58.302931') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (35.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (36.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:46:59.561171', '2025-10-04 21:46:59.561175') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:46:59.564491', '2025-10-04 21:46:59.564493') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:46:59.626671', '2025-10-04 21:46:59.626671'), (2, 'Theo Becker', '2025-10-04 21:46:59.626671', '2025-10-04 21:46:59.626671');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:46:59.650944', '2025-10-04 21:46:59.650944'), (298486374, 2, '2025-10-04 21:46:59.650944', '2025-10-04 21:46:59.650944')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:46:59 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.7ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: ef07e163-c6e4-44e9-b922-35e56052fb8a) to Test(default) with arguments: #<GlobalID:0x00007f9ff4a28410 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 6ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 3897)
[ActiveJob] [UpvoteJob] [ef07e163-c6e4-44e9-b922-35e56052fb8a]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [ef07e163-c6e4-44e9-b922-35e56052fb8a] Performing UpvoteJob (Job ID: ef07e163-c6e4-44e9-b922-35e56052fb8a) from Test(default) enqueued at 2025-10-04T21:46:59.758408746Z with arguments: #<GlobalID:0x00007f9ff5798eb0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [ef07e163-c6e4-44e9-b922-35e56052fb8a]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [ef07e163-c6e4-44e9-b922-35e56052fb8a]   [1m[36mVote Create (1.2ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:46:59.890599"], ["updated_at", "2025-10-04 21:46:59.890599"]]
[ActiveJob] [UpvoteJob] [ef07e163-c6e4-44e9-b922-35e56052fb8a]   [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [ef07e163-c6e4-44e9-b922-35e56052fb8a] Performed UpvoteJob (Job ID: ef07e163-c6e4-44e9-b922-35e56052fb8a) from Test(default) in 135.23ms
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:47:01.559220', '2025-10-04 21:47:01.559220'), (2, 'Theo Becker', '2025-10-04 21:47:01.559220', '2025-10-04 21:47:01.559220');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:47:01.565744', '2025-10-04 21:47:01.565744'), (298486374, 2, '2025-10-04 21:47:01.565744', '2025-10-04 21:47:01.565744')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [5c0ce474-6bfb-40c6-a006-9ed611a7ebf0] Performing UpvoteJob (Job ID: 5c0ce474-6bfb-40c6-a006-9ed611a7ebf0) from Test(default) with arguments: #<GlobalID:0x0000778d3e25af10 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [5c0ce474-6bfb-40c6-a006-9ed611a7ebf0]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [5c0ce474-6bfb-40c6-a006-9ed611a7ebf0]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:47:01.628845"], ["updated_at", "2025-10-04 21:47:01.628845"]]
[ActiveJob] [UpvoteJob] [5c0ce474-6bfb-40c6-a006-9ed611a7ebf0]   [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [5c0ce474-6bfb-40c6-a006-9ed611a7ebf0] Performed UpvoteJob (Job ID: 5c0ce474-6bfb-40c6-a006-9ed611a7ebf0) from Test(default) in 17.37ms
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:47:41.238804', '2025-10-04 21:47:41.238806') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (28.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.0ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 21:47:42.483694', '2025-10-04 21:47:42.483696') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 21:47:42.485616', '2025-10-04 21:47:42.485617') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:47:42.542287', '2025-10-04 21:47:42.542287'), (2, 'Theo Becker', '2025-10-04 21:47:42.542287', '2025-10-04 21:47:42.542287');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:47:42.561151', '2025-10-04 21:47:42.561151'), (298486374, 2, '2025-10-04 21:47:42.561151', '2025-10-04 21:47:42.561151')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 18:47:42 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: cdbc481c-f4e0-4a55-b061-65df5ca032cd) to Test(default) with arguments: #<GlobalID:0x0000796524664ee8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [cdbc481c-f4e0-4a55-b061-65df5ca032cd]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [cdbc481c-f4e0-4a55-b061-65df5ca032cd] Performing UpvoteJob (Job ID: cdbc481c-f4e0-4a55-b061-65df5ca032cd) from Test(default) enqueued at 2025-10-04T21:47:42.651694359Z with arguments: #<GlobalID:0x00007965254941d0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [cdbc481c-f4e0-4a55-b061-65df5ca032cd]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [cdbc481c-f4e0-4a55-b061-65df5ca032cd]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:47:42.786761"], ["updated_at", "2025-10-04 21:47:42.786761"]]
[ActiveJob] [UpvoteJob] [cdbc481c-f4e0-4a55-b061-65df5ca032cd]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [cdbc481c-f4e0-4a55-b061-65df5ca032cd] Performed UpvoteJob (Job ID: cdbc481c-f4e0-4a55-b061-65df5ca032cd) from Test(default) in 136.99ms
  [1m[36mVote Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 21:47:44.433926', '2025-10-04 21:47:44.433926'), (2, 'Theo Becker', '2025-10-04 21:47:44.433926', '2025-10-04 21:47:44.433926');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 21:47:44.438683', '2025-10-04 21:47:44.438683'), (298486374, 2, '2025-10-04 21:47:44.438683', '2025-10-04 21:47:44.438683')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [a5a6283c-7d58-44c1-a529-26de9f0e294e] Performing UpvoteJob (Job ID: a5a6283c-7d58-44c1-a529-26de9f0e294e) from Test(default) with arguments: #<GlobalID:0x000073c412cd2e00 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [a5a6283c-7d58-44c1-a529-26de9f0e294e]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [a5a6283c-7d58-44c1-a529-26de9f0e294e]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 21:47:44.490466"], ["updated_at", "2025-10-04 21:47:44.490466"]]
[ActiveJob] [UpvoteJob] [a5a6283c-7d58-44c1-a529-26de9f0e294e]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [a5a6283c-7d58-44c1-a529-26de9f0e294e] Performed UpvoteJob (Job ID: a5a6283c-7d58-44c1-a529-26de9f0e294e) from Test(default) in 18.08ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:12:54.518941', '2025-10-04 22:12:54.518944') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (31.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (30.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:12:55.753054', '2025-10-04 22:12:55.753058') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:12:55.756230', '2025-10-04 22:12:55.756233') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:12:55.824850', '2025-10-04 22:12:55.824850'), (2, 'Theo Becker', '2025-10-04 22:12:55.824850', '2025-10-04 22:12:55.824850');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:12:55.844727', '2025-10-04 22:12:55.844727'), (298486374, 2, '2025-10-04 22:12:55.844727', '2025-10-04 22:12:55.844727')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ParticipantsControllerTest: test_should_update_votes_on_calling_/participants/{id}/upvote
-----------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 19:12:55 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f) to Test(default) with arguments: #<GlobalID:0x00007e7fbc3981a8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 5ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f] Performing UpvoteJob (Job ID: fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f) from Test(default) enqueued at 2025-10-04T22:12:55.950803918Z with arguments: #<GlobalID:0x00007e7fbd1247e0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 22:12:56.140158"], ["updated_at", "2025-10-04 22:12:56.140158"]]
[ActiveJob] [UpvoteJob] [fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f] Performed UpvoteJob (Job ID: fa6f9e0e-be03-4d84-a4ad-f96e52a3e04f) from Test(default) in 190.84ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:12:57.701263', '2025-10-04 22:12:57.701263'), (2, 'Theo Becker', '2025-10-04 22:12:57.701263', '2025-10-04 22:12:57.701263');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:12:57.705919', '2025-10-04 22:12:57.705919'), (298486374, 2, '2025-10-04 22:12:57.705919', '2025-10-04 22:12:57.705919')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [20b6cdc0-d70b-4d80-b9b3-ab422d11bae1] Performing UpvoteJob (Job ID: 20b6cdc0-d70b-4d80-b9b3-ab422d11bae1) from Test(default) with arguments: #<GlobalID:0x000071f328e101d0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [20b6cdc0-d70b-4d80-b9b3-ab422d11bae1]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [20b6cdc0-d70b-4d80-b9b3-ab422d11bae1]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 22:12:57.777894"], ["updated_at", "2025-10-04 22:12:57.777894"]]
[ActiveJob] [UpvoteJob] [20b6cdc0-d70b-4d80-b9b3-ab422d11bae1]   [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [20b6cdc0-d70b-4d80-b9b3-ab422d11bae1] Performed UpvoteJob (Job ID: 20b6cdc0-d70b-4d80-b9b3-ab422d11bae1) from Test(default) in 19.06ms
  [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:12:59.315351', '2025-10-04 22:12:59.315351'), (2, 'Theo Becker', '2025-10-04 22:12:59.315351', '2025-10-04 22:12:59.315351');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:12:59.319697', '2025-10-04 22:12:59.319697'), (298486374, 2, '2025-10-04 22:12:59.319697', '2025-10-04 22:12:59.319697')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ParticipantTest: test_Order_results_by_name_A-Z
-----------------------------------------------
  [1m[36mParticipant Load (0.9ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (1.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:22:44.286639', '2025-10-04 22:22:44.286642') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (30.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.0ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (3.4ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:22:45.529467', '2025-10-04 22:22:45.529472') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:22:45.531990', '2025-10-04 22:22:45.531993') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:22:45.600997', '2025-10-04 22:22:45.600997'), (2, 'Theo Becker', '2025-10-04 22:22:45.600997', '2025-10-04 22:22:45.600997');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:22:45.620207', '2025-10-04 22:22:45.620207'), (298486374, 2, '2025-10-04 22:22:45.620207', '2025-10-04 22:22:45.620207')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_it_should_update_votes_on_calling_/participants/{id}/upvote
--------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-04 19:22:45 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 42ee0ec9-8328-452c-bbfa-a9d8093a0619) to Test(default) with arguments: #<GlobalID:0x0000796bac0d8658 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 5ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 3898)
[ActiveJob] [UpvoteJob] [42ee0ec9-8328-452c-bbfa-a9d8093a0619]   [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [42ee0ec9-8328-452c-bbfa-a9d8093a0619] Performing UpvoteJob (Job ID: 42ee0ec9-8328-452c-bbfa-a9d8093a0619) from Test(default) enqueued at 2025-10-04T22:22:45.720763793Z with arguments: #<GlobalID:0x0000796bace59430 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [42ee0ec9-8328-452c-bbfa-a9d8093a0619]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [42ee0ec9-8328-452c-bbfa-a9d8093a0619]   [1m[36mVote Create (1.6ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 22:22:45.869024"], ["updated_at", "2025-10-04 22:22:45.869024"]]
[ActiveJob] [UpvoteJob] [42ee0ec9-8328-452c-bbfa-a9d8093a0619]   [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [42ee0ec9-8328-452c-bbfa-a9d8093a0619] Performed UpvoteJob (Job ID: 42ee0ec9-8328-452c-bbfa-a9d8093a0619) from Test(default) in 151.01ms
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:22:47.475929', '2025-10-04 22:22:47.475929'), (2, 'Theo Becker', '2025-10-04 22:22:47.475929', '2025-10-04 22:22:47.475929');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:22:47.483436', '2025-10-04 22:22:47.483436'), (298486374, 2, '2025-10-04 22:22:47.483436', '2025-10-04 22:22:47.483436')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [42a6218e-dcbc-4907-98fc-12d641fa8ded] Performing UpvoteJob (Job ID: 42a6218e-dcbc-4907-98fc-12d641fa8ded) from Test(default) with arguments: #<GlobalID:0x0000747785eba688 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [42a6218e-dcbc-4907-98fc-12d641fa8ded]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [42a6218e-dcbc-4907-98fc-12d641fa8ded]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 22:22:47.546446"], ["updated_at", "2025-10-04 22:22:47.546446"]]
[ActiveJob] [UpvoteJob] [42a6218e-dcbc-4907-98fc-12d641fa8ded]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [42a6218e-dcbc-4907-98fc-12d641fa8ded] Performed UpvoteJob (Job ID: 42a6218e-dcbc-4907-98fc-12d641fa8ded) from Test(default) in 15.7ms
  [1m[36mVote Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:22:49.153773', '2025-10-04 22:22:49.153773'), (2, 'Theo Becker', '2025-10-04 22:22:49.153773', '2025-10-04 22:22:49.153773');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:22:49.169228', '2025-10-04 22:22:49.169228'), (298486374, 2, '2025-10-04 22:22:49.169228', '2025-10-04 22:22:49.169228')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_higheist_votes
--------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [47ce8d39-1ec5-49a4-a8cc-dc36386449e9] Performing UpvoteJob (Job ID: 47ce8d39-1ec5-49a4-a8cc-dc36386449e9) from Sidekiq(default) with arguments: #<GlobalID:0x00007bf0f8ed2a50 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [47ce8d39-1ec5-49a4-a8cc-dc36386449e9]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [47ce8d39-1ec5-49a4-a8cc-dc36386449e9]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 22:22:49.220698"], ["updated_at", "2025-10-04 22:22:49.220698"]]
[ActiveJob] [UpvoteJob] [47ce8d39-1ec5-49a4-a8cc-dc36386449e9]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [47ce8d39-1ec5-49a4-a8cc-dc36386449e9] Performed UpvoteJob (Job ID: 47ce8d39-1ec5-49a4-a8cc-dc36386449e9) from Sidekiq(default) in 5.51ms
  [1m[36mParticipant Load (0.8ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id" ORDER BY votes_count DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (18.9ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:24:23.440183', '2025-10-04 22:24:23.440186') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (33.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (28.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:24:24.656840', '2025-10-04 22:24:24.656844') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:24:24.658977', '2025-10-04 22:24:24.658978') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:24:24.723775', '2025-10-04 22:24:24.723775'), (2, 'Theo Becker', '2025-10-04 22:24:24.723775', '2025-10-04 22:24:24.723775');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:24:24.745789', '2025-10-04 22:24:24.745789'), (298486374, 2, '2025-10-04 22:24:24.745789', '2025-10-04 22:24:24.745789')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (19.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_higheist_votes
--------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [4479ea64-1c0c-41a8-a677-41cf96924d6e] Performing UpvoteJob (Job ID: 4479ea64-1c0c-41a8-a677-41cf96924d6e) from Sidekiq(default) with arguments: #<GlobalID:0x000077e3ad3a7da8 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [4479ea64-1c0c-41a8-a677-41cf96924d6e]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [4479ea64-1c0c-41a8-a677-41cf96924d6e]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-04 22:24:24.850343"], ["updated_at", "2025-10-04 22:24:24.850343"]]
[ActiveJob] [UpvoteJob] [4479ea64-1c0c-41a8-a677-41cf96924d6e]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [4479ea64-1c0c-41a8-a677-41cf96924d6e] Performed UpvoteJob (Job ID: 4479ea64-1c0c-41a8-a677-41cf96924d6e) from Sidekiq(default) in 6.33ms
  [1m[36mParticipant Load (0.7ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id" ORDER BY votes_count DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mVote Pluck (0.2ms)[0m  [1m[34mSELECT "votes"."id" FROM "votes" WHERE "votes"."participant_id" = $1[0m  [["participant_id", 1]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:27:10.034137', '2025-10-04 22:27:10.034139') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (25.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (25.8ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:27:11.257842', '2025-10-04 22:27:11.257845') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:27:11.259878', '2025-10-04 22:27:11.259880') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:27:11.322876', '2025-10-04 22:27:11.322876'), (2, 'Theo Becker', '2025-10-04 22:27:11.322876', '2025-10-04 22:27:11.322876');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:27:11.350252', '2025-10-04 22:27:11.350252'), (298486374, 2, '2025-10-04 22:27:11.350252', '2025-10-04 22:27:11.350252')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.7ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (18.9ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_higheist_votes
--------------------------------------------------------------------
  [1m[36mParticipant Load (0.5ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [e2334c8a-6763-4133-b199-2098d7d7b51c] Performing UpvoteJob (Job ID: e2334c8a-6763-4133-b199-2098d7d7b51c) from Sidekiq(default) with arguments: #<GlobalID:0x00007c0b0599c898 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [e2334c8a-6763-4133-b199-2098d7d7b51c]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [e2334c8a-6763-4133-b199-2098d7d7b51c]   [1m[36mVote Create (1.7ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:27:11.451497"], ["updated_at", "2025-10-04 22:27:11.451497"]]
[ActiveJob] [UpvoteJob] [e2334c8a-6763-4133-b199-2098d7d7b51c]   [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [e2334c8a-6763-4133-b199-2098d7d7b51c] Performed UpvoteJob (Job ID: e2334c8a-6763-4133-b199-2098d7d7b51c) from Sidekiq(default) in 6.54ms
  [1m[36mParticipant Load (1.4ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id" ORDER BY votes_count DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:35:17.171482', '2025-10-04 22:35:17.171485') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (26.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (28.2ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.6ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:35:18.420358', '2025-10-04 22:35:18.420361') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:35:18.422395', '2025-10-04 22:35:18.422396') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:35:18.505161', '2025-10-04 22:35:18.505161'), (2, 'Theo Becker', '2025-10-04 22:35:18.505161', '2025-10-04 22:35:18.505161');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:35:18.539607', '2025-10-04 22:35:18.539607'), (298486374, 2, '2025-10-04 22:35:18.539607', '2025-10-04 22:35:18.539607')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
VoteTest: test_it_should_order_votes_by_its_creation_date
---------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [80111d99-0920-411d-bf39-772491567f89] Performing UpvoteJob (Job ID: 80111d99-0920-411d-bf39-772491567f89) from Sidekiq(default) with arguments: #<GlobalID:0x00007fd2f44e2568 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [80111d99-0920-411d-bf39-772491567f89]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [80111d99-0920-411d-bf39-772491567f89]   [1m[36mVote Create (1.1ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:35:18.627614"], ["updated_at", "2025-10-04 22:35:18.627614"]]
[ActiveJob] [UpvoteJob] [80111d99-0920-411d-bf39-772491567f89]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [80111d99-0920-411d-bf39-772491567f89] Performed UpvoteJob (Job ID: 80111d99-0920-411d-bf39-772491567f89) from Sidekiq(default) in 17.06ms
  [1m[36mVote Load (0.2ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:35:18.640578', '2025-10-04 22:35:18.640578'), (2, 'Theo Becker', '2025-10-04 22:35:18.640578', '2025-10-04 22:35:18.640578');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:35:18.640618', '2025-10-04 22:35:18.640618'), (298486374, 2, '2025-10-04 22:35:18.640618', '2025-10-04 22:35:18.640618')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (14.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_highest_votes
-------------------------------------------------------------------
  [1m[36mParticipant Load (0.9ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [6b0135c5-1bad-47ee-8510-afb19284a438] Performing UpvoteJob (Job ID: 6b0135c5-1bad-47ee-8510-afb19284a438) from Sidekiq(default) with arguments: #<GlobalID:0x00007fd2f41660b0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [6b0135c5-1bad-47ee-8510-afb19284a438]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [6b0135c5-1bad-47ee-8510-afb19284a438]   [1m[36mVote Create (1.3ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:35:18.722275"], ["updated_at", "2025-10-04 22:35:18.722275"]]
[ActiveJob] [UpvoteJob] [6b0135c5-1bad-47ee-8510-afb19284a438]   [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [6b0135c5-1bad-47ee-8510-afb19284a438] Performed UpvoteJob (Job ID: 6b0135c5-1bad-47ee-8510-afb19284a438) from Sidekiq(default) in 3.42ms
  [1m[36mParticipant Load (0.8ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id" ORDER BY votes_count DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:37:14.124136', '2025-10-04 22:37:14.124140') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (28.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (26.1ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:37:15.377651', '2025-10-04 22:37:15.377654') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:37:15.379520', '2025-10-04 22:37:15.379521') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:37:15.442545', '2025-10-04 22:37:15.442545'), (2, 'Theo Becker', '2025-10-04 22:37:15.442545', '2025-10-04 22:37:15.442545');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:37:15.461981', '2025-10-04 22:37:15.461981'), (298486374, 2, '2025-10-04 22:37:15.461981', '2025-10-04 22:37:15.461981')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
VoteTest: test_it_should_order_votes_by_its_creation_date_higher_to_lower
-------------------------------------------------------------------------
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [6980e5b3-acee-4925-9200-13d4d59dbaf3] Performing UpvoteJob (Job ID: 6980e5b3-acee-4925-9200-13d4d59dbaf3) from Sidekiq(default) with arguments: #<GlobalID:0x000073f7b8dcb8f0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [6980e5b3-acee-4925-9200-13d4d59dbaf3]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [6980e5b3-acee-4925-9200-13d4d59dbaf3]   [1m[36mVote Create (1.4ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:37:15.538731"], ["updated_at", "2025-10-04 22:37:15.538731"]]
[ActiveJob] [UpvoteJob] [6980e5b3-acee-4925-9200-13d4d59dbaf3]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [6980e5b3-acee-4925-9200-13d4d59dbaf3] Performed UpvoteJob (Job ID: 6980e5b3-acee-4925-9200-13d4d59dbaf3) from Sidekiq(default) in 18.16ms
  [1m[36mVote Load (0.4ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:37:15.549085', '2025-10-04 22:37:15.549085'), (2, 'Theo Becker', '2025-10-04 22:37:15.549085', '2025-10-04 22:37:15.549085');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:37:15.549131', '2025-10-04 22:37:15.549131'), (298486374, 2, '2025-10-04 22:37:15.549131', '2025-10-04 22:37:15.549131')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_highest_votes
-------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [8fa9373f-4aeb-4a5c-87e2-98b73f591010] Performing UpvoteJob (Job ID: 8fa9373f-4aeb-4a5c-87e2-98b73f591010) from Sidekiq(default) with arguments: #<GlobalID:0x000073f7ba7c0760 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [8fa9373f-4aeb-4a5c-87e2-98b73f591010]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [8fa9373f-4aeb-4a5c-87e2-98b73f591010]   [1m[36mVote Create (0.8ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:37:15.602136"], ["updated_at", "2025-10-04 22:37:15.602136"]]
[ActiveJob] [UpvoteJob] [8fa9373f-4aeb-4a5c-87e2-98b73f591010]   [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [8fa9373f-4aeb-4a5c-87e2-98b73f591010] Performed UpvoteJob (Job ID: 8fa9373f-4aeb-4a5c-87e2-98b73f591010) from Sidekiq(default) in 2.73ms
  [1m[36mParticipant Load (0.7ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id" ORDER BY votes_count DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (13.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:40:28.513411', '2025-10-04 22:40:28.513413') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (32.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (28.2ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:40:29.762259', '2025-10-04 22:40:29.762265') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:40:29.769519', '2025-10-04 22:40:29.769523') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:40:29.840537', '2025-10-04 22:40:29.840537'), (2, 'Theo Becker', '2025-10-04 22:40:29.840537', '2025-10-04 22:40:29.840537');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:40:29.859827', '2025-10-04 22:40:29.859827'), (298486374, 2, '2025-10-04 22:40:29.859827', '2025-10-04 22:40:29.859827')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
VoteTest: test_it_should_order_votes_by_its_creation_date_higher_to_lower
-------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [9294f6fd-2601-4763-b6e2-67d8d7527dee] Performing UpvoteJob (Job ID: 9294f6fd-2601-4763-b6e2-67d8d7527dee) from Sidekiq(default) with arguments: #<GlobalID:0x000076551ab59420 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [9294f6fd-2601-4763-b6e2-67d8d7527dee]   [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [9294f6fd-2601-4763-b6e2-67d8d7527dee]   [1m[36mVote Create (1.4ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:40:29.932526"], ["updated_at", "2025-10-04 22:40:29.932526"]]
[ActiveJob] [UpvoteJob] [9294f6fd-2601-4763-b6e2-67d8d7527dee]   [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [9294f6fd-2601-4763-b6e2-67d8d7527dee] Performed UpvoteJob (Job ID: 9294f6fd-2601-4763-b6e2-67d8d7527dee) from Sidekiq(default) in 17.51ms
  [1m[36mVote Load (0.2ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:40:29.940981', '2025-10-04 22:40:29.940981'), (2, 'Theo Becker', '2025-10-04 22:40:29.940981', '2025-10-04 22:40:29.940981');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:40:29.941019', '2025-10-04 22:40:29.941019'), (298486374, 2, '2025-10-04 22:40:29.941019', '2025-10-04 22:40:29.941019')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_highest_votes
-------------------------------------------------------------------
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [6fed668e-941f-4b1d-a368-9bb9f90dadc5] Performing UpvoteJob (Job ID: 6fed668e-941f-4b1d-a368-9bb9f90dadc5) from Sidekiq(default) with arguments: #<GlobalID:0x000076551abd6218 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [6fed668e-941f-4b1d-a368-9bb9f90dadc5]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [6fed668e-941f-4b1d-a368-9bb9f90dadc5]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:40:30.009420"], ["updated_at", "2025-10-04 22:40:30.009420"]]
[ActiveJob] [UpvoteJob] [6fed668e-941f-4b1d-a368-9bb9f90dadc5]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [6fed668e-941f-4b1d-a368-9bb9f90dadc5] Performed UpvoteJob (Job ID: 6fed668e-941f-4b1d-a368-9bb9f90dadc5) from Sidekiq(default) in 3.05ms
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY :id ORDER BY "votes_count" DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (18.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (2.3ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:40:56.940019', '2025-10-04 22:40:56.940021') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (27.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (31.9ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-04 22:40:58.194714', '2025-10-04 22:40:58.194717') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-04 22:40:58.196886', '2025-10-04 22:40:58.196887') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:40:58.251194', '2025-10-04 22:40:58.251194'), (2, 'Theo Becker', '2025-10-04 22:40:58.251194', '2025-10-04 22:40:58.251194');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:40:58.270412', '2025-10-04 22:40:58.270412'), (298486374, 2, '2025-10-04 22:40:58.270412', '2025-10-04 22:40:58.270412')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (22.7ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_highest_votes
-------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [6d394377-4e70-4f4e-8a98-285d1ed3eba6] Performing UpvoteJob (Job ID: 6d394377-4e70-4f4e-8a98-285d1ed3eba6) from Sidekiq(default) with arguments: #<GlobalID:0x00007a8e697ca318 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [6d394377-4e70-4f4e-8a98-285d1ed3eba6]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [6d394377-4e70-4f4e-8a98-285d1ed3eba6]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:40:58.373554"], ["updated_at", "2025-10-04 22:40:58.373554"]]
[ActiveJob] [UpvoteJob] [6d394377-4e70-4f4e-8a98-285d1ed3eba6]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [6d394377-4e70-4f4e-8a98-285d1ed3eba6] Performed UpvoteJob (Job ID: 6d394377-4e70-4f4e-8a98-285d1ed3eba6) from Sidekiq(default) in 5.84ms
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id" ORDER BY "votes_count" DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-04 22:40:58.379977', '2025-10-04 22:40:58.379977'), (2, 'Theo Becker', '2025-10-04 22:40:58.379977', '2025-10-04 22:40:58.379977');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-04 22:40:58.380016', '2025-10-04 22:40:58.380016'), (298486374, 2, '2025-10-04 22:40:58.380016', '2025-10-04 22:40:58.380016')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
VoteTest: test_it_should_order_votes_by_its_creation_date_higher_to_lower
-------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [64a093e3-e6d4-4854-a9e9-7f42821f8b24] Performing UpvoteJob (Job ID: 64a093e3-e6d4-4854-a9e9-7f42821f8b24) from Sidekiq(default) with arguments: #<GlobalID:0x00007a8e68246410 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [64a093e3-e6d4-4854-a9e9-7f42821f8b24]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [64a093e3-e6d4-4854-a9e9-7f42821f8b24]   [1m[36mVote Create (0.8ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-04 22:40:58.431269"], ["updated_at", "2025-10-04 22:40:58.431269"]]
[ActiveJob] [UpvoteJob] [64a093e3-e6d4-4854-a9e9-7f42821f8b24]   [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [64a093e3-e6d4-4854-a9e9-7f42821f8b24] Performed UpvoteJob (Job ID: 64a093e3-e6d4-4854-a9e9-7f42821f8b24) from Sidekiq(default) in 2.63ms
  [1m[36mVote Load (0.1ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mParticipant Load (0.1ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.7ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-06 23:25:07.920781', '2025-10-06 23:25:07.920784') RETURNING "key"[0m
Migrating to CreateParticipants (20250928022636)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250928022636') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateVotes (20251004154952)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251004154952') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (30.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "postgres_teste"[0m
  [1m[35m (29.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.8ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "participants" CASCADE[0m
  [1m[35m (4.6ms)[0m  [1m[35mCREATE TABLE "participants" ("id" bigserial primary key, "name" character varying(100) NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "votes" CASCADE[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "votes" ("id" bigserial primary key, "participant_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_votes_on_participant_id" ON "votes" ("participant_id")[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "votes" ADD CONSTRAINT "fk_rails_7d535390f0"
FOREIGN KEY ("participant_id")
  REFERENCES "participants" ("id")
[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251004154952)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250928022636);[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-10-06 23:25:09.102463', '2025-10-06 23:25:09.102465') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'ace0fc2bee60d7c4d773e07844bfc484feb800ce', '2025-10-06 23:25:09.104550', '2025-10-06 23:25:09.104551') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-06 23:25:09.168042', '2025-10-06 23:25:09.168042'), (2, 'Theo Becker', '2025-10-06 23:25:09.168042', '2025-10-06 23:25:09.168042');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-06 23:25:09.187588', '2025-10-06 23:25:09.187588'), (298486374, 2, '2025-10-06 23:25:09.187588', '2025-10-06 23:25:09.187588')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ParticipantsControllerTest: test_it_should_update_votes_on_calling_/participants/{id}/upvote
--------------------------------------------------------------------------------------------
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started PATCH "/participants/1/upvote" for 127.0.0.1 at 2025-10-06 20:25:09 -0300
Processing by ParticipantsController#upvote as HTML
  Parameters: {"id"=>"1"}
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Voto para participante 1
[ActiveJob] Enqueued UpvoteJob (Job ID: 492719fe-8d5a-4fe4-8ef5-ce3022649ff2) to Test(default) with arguments: #<GlobalID:0x000070dc5d960a00 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
Completed 202 Accepted in 5ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 4073)
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2] Performing UpvoteJob (Job ID: 492719fe-8d5a-4fe4-8ef5-ce3022649ff2) from Test(default) enqueued at 2025-10-06T23:25:09.274769189Z with arguments: #<GlobalID:0x000070dc5d9533a0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mParticipant Load (0.3ms)[0m  [1m[37mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mVote Create (0.7ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-06 23:25:09.283715"], ["updated_at", "2025-10-06 23:25:09.283715"]]
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mVote Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "votes" LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mVote Load (0.2ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mVote Load (0.1ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mParticipant Load (1.0ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name" /* loading for inspect */ LIMIT $1[0m  [["LIMIT", 11]]
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2] [ActionCable] Broadcasting to statistics_stream: {:type=>"statistics_update", :data=>{:total_votes=>3, :votes_per_hour=>3, :participants=>#<ActiveRecord::Relation [#<Participant id: 1, name: "Andressa Urach", votes_count: 2>, #<Participant id: 2, name: "Theo Becker", votes_count: 1>]>}}
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2]   [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name"[0m
[ActiveJob] [UpvoteJob] [492719fe-8d5a-4fe4-8ef5-ce3022649ff2] Performed UpvoteJob (Job ID: 492719fe-8d5a-4fe4-8ef5-ce3022649ff2) from Test(default) in 20.9ms
  [1m[36mCACHE Vote Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-06 23:25:10.839206', '2025-10-06 23:25:10.839206'), (2, 'Theo Becker', '2025-10-06 23:25:10.839206', '2025-10-06 23:25:10.839206');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-06 23:25:10.843705', '2025-10-06 23:25:10.843705'), (298486374, 2, '2025-10-06 23:25:10.843705', '2025-10-06 23:25:10.843705')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UpvoteJobTest: test_it_should_update_votes_count
------------------------------------------------
  [1m[36mParticipant Load (0.7ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d] Performing UpvoteJob (Job ID: 852d118e-7cac-4a82-a07f-460392a2ab9d) from Test(default) with arguments: #<GlobalID:0x0000791506cecef0 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/1>>
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mParticipant Load (0.7ms)[0m  [1m[37mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mVote Create (1.0ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 1], ["created_at", "2025-10-06 23:25:10.905709"], ["updated_at", "2025-10-06 23:25:10.905709"]]
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mVote Count (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mVote Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "votes" LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mVote Load (0.2ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mVote Load (0.1ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mParticipant Load (1.4ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name" /* loading for inspect */ LIMIT $1[0m  [["LIMIT", 11]]
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d] [ActionCable] Broadcasting to statistics_stream: {:type=>"statistics_update", :data=>{:total_votes=>3, :votes_per_hour=>3, :participants=>#<ActiveRecord::Relation [#<Participant id: 1, name: "Andressa Urach", votes_count: 2>, #<Participant id: 2, name: "Theo Becker", votes_count: 1>]>}}
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d]   [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name"[0m
[ActiveJob] [UpvoteJob] [852d118e-7cac-4a82-a07f-460392a2ab9d] Performed UpvoteJob (Job ID: 852d118e-7cac-4a82-a07f-460392a2ab9d) from Test(default) in 21.77ms
  [1m[36mCACHE Vote Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE "postgres_teste" ENCODING = 'unicode'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(4231483750102598115)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-06 23:25:12.481504', '2025-10-06 23:25:12.481504'), (2, 'Theo Becker', '2025-10-06 23:25:12.481504', '2025-10-06 23:25:12.481504');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-06 23:25:12.486207', '2025-10-06 23:25:12.486207'), (298486374, 2, '2025-10-06 23:25:12.486207', '2025-10-06 23:25:12.486207')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ParticipantTest: test_it_should_order_results_by_name_A-Z
---------------------------------------------------------
  [1m[36mParticipant Load (0.6ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."name" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (20.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ParticipantTest: test_it_should_order_participants_by_highest_votes
-------------------------------------------------------------------
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048] Performing UpvoteJob (Job ID: d3781e66-05ca-44e2-a10d-3f33f0420048) from Sidekiq(default) with arguments: #<GlobalID:0x000078ac1cb31208 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mParticipant Load (0.4ms)[0m  [1m[37mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mVote Create (0.7ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-06 23:25:12.589940"], ["updated_at", "2025-10-06 23:25:12.589940"]]
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mVote Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mVote Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "votes" LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mVote Load (0.1ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mVote Load (0.1ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mParticipant Load (0.8ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name" /* loading for inspect */ LIMIT $1[0m  [["LIMIT", 11]]
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048] [ActionCable] Broadcasting to statistics_stream: {:type=>"statistics_update", :data=>{:total_votes=>3, :votes_per_hour=>3, :participants=>#<ActiveRecord::Relation [#<Participant id: 1, name: "Andressa Urach", votes_count: 1>, #<Participant id: 2, name: "Theo Becker", votes_count: 2>]>}}
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048]   [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name"[0m
[ActiveJob] [UpvoteJob] [d3781e66-05ca-44e2-a10d-3f33f0420048] Performed UpvoteJob (Job ID: d3781e66-05ca-44e2-a10d-3f33f0420048) from Sidekiq(default) in 14.27ms
  [1m[36mParticipant Load (0.4ms)[0m  [1m[34mSELECT participants.*, COUNT(votes.id) AS votes_count FROM "participants" LEFT OUTER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id" ORDER BY "votes_count" DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "participants" DISABLE TRIGGER ALL;ALTER TABLE "votes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "participants";
DELETE FROM "votes";
INSERT INTO "participants" ("id", "name", "created_at", "updated_at") VALUES (1, 'Andressa Urach', '2025-10-06 23:25:12.602106', '2025-10-06 23:25:12.602106'), (2, 'Theo Becker', '2025-10-06 23:25:12.602106', '2025-10-06 23:25:12.602106');
INSERT INTO "votes" ("id", "participant_id", "created_at", "updated_at") VALUES (980190962, 1, '2025-10-06 23:25:12.602148', '2025-10-06 23:25:12.602148'), (298486374, 2, '2025-10-06 23:25:12.602148', '2025-10-06 23:25:12.602148')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "participants" ENABLE TRIGGER ALL;ALTER TABLE "votes" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
VoteTest: test_it_should_order_votes_by_its_creation_date_higher_to_lower
-------------------------------------------------------------------------
  [1m[36mParticipant Load (0.2ms)[0m  [1m[34mSELECT "participants".* FROM "participants" ORDER BY "participants"."id" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d] Performing UpvoteJob (Job ID: 8a991516-14f8-4d96-8a0b-d4627fd4bf3d) from Sidekiq(default) with arguments: #<GlobalID:0x000078ac1dc51510 @uri=#<URI::GID gid://teste-tecnico-laager-backend/Participant/2>>
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mParticipant Load (0.3ms)[0m  [1m[37mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mVote Create (0.5ms)[0m  [1m[32mINSERT INTO "votes" ("participant_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["participant_id", 2], ["created_at", "2025-10-06 23:25:12.649853"], ["updated_at", "2025-10-06 23:25:12.649853"]]
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mVote Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "votes"[0m
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mVote Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "votes" LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mVote Load (0.4ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mVote Load (0.5ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" ASC LIMIT $1[0m  [["LIMIT", 1]]
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mParticipant Load (1.4ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name" /* loading for inspect */ LIMIT $1[0m  [["LIMIT", 11]]
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d] [ActionCable] Broadcasting to statistics_stream: {:type=>"statistics_update", :data=>{:total_votes=>3, :votes_per_hour=>3, :participants=>#<ActiveRecord::Relation [#<Participant id: 1, name: "Andressa Urach", votes_count: 1>, #<Participant id: 2, name: "Theo Becker", votes_count: 2>]>}}
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d]   [1m[36mParticipant Load (0.7ms)[0m  [1m[34mSELECT participants.id, participants.name, COUNT(votes.id) AS votes_count FROM "participants" INNER JOIN "votes" ON "votes"."participant_id" = "participants"."id" GROUP BY "participants"."id", "participants"."name"[0m
[ActiveJob] [UpvoteJob] [8a991516-14f8-4d96-8a0b-d4627fd4bf3d] Performed UpvoteJob (Job ID: 8a991516-14f8-4d96-8a0b-d4627fd4bf3d) from Sidekiq(default) in 12.6ms
  [1m[36mCACHE Vote Load (0.0ms)[0m  [1m[34mSELECT "votes".* FROM "votes" ORDER BY "votes"."created_at" DESC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mParticipant Load (0.3ms)[0m  [1m[34mSELECT "participants".* FROM "participants" WHERE "participants"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
